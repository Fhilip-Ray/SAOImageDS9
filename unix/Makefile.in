prefix		= @prefix@
exec_prefix	= @exec_prefix@

bindir		= @bindir@
libdir		= $(exec_prefix)/lib
#libdir		= @libdir@
includedir	= @includedir@
datarootdir	= @datarootdir@
datadir		= @datadir@
mandir		= @mandir@

OS		= @OS@
ARCH		= @ARCH@
TKFLAGS		= @TKFLAGS@
TKIMGFLAGS	= @TKIMGFLAGS@
JOBS		= @CORES@

WITHTCL 	= --with-tcl=$(prefix)/tcl$(TCLVER)/unix
WITHTK  	= --with-tk=$(prefix)/tk$(TCLVER)/unix $(WITHTCL)
CACHE		= --config-cache --cache-file=$(prefix)/config.cache

include ./make.include

#--------------------------build

.PHONY	: saods9 tcl tk

saods9	: tcl tk \
	tclcheckdns tcliis tclsignal \
	tclzvfs tclxml xpa \
	tkblt tktable tkimg \
	tkmpeg tkhtml1 tkcon \
	tksao ds9

tcl	: tcl$(TCLVER)/unix/Makefile
	@echo ""
	@echo "*** Install tcl$(TCLVER) ***"
	$(MAKE) -C tcl$(TCLVER)/unix -j $(JOBS) install

tcl$(TCLVER)/unix/Makefile :
	@echo ""
	@echo "*** Configure tcl$(TCLVER) ***"
	cd tcl$(TCLVER)/unix; \
	./configure \
	--prefix $(prefix) --exec-prefix $(exec_prefix) --libdir $(libdir) \
	--disable-shared --enable-symbols \
	--config-cache --cache-file=$(prefix)/config.cache

tk	: tk$(TCLVER)/unix/Makefile
	@echo ""
	@echo "*** Install tk$(TCLVER) ***"
	$(MAKE) -C tk$(TCLVER)/unix -j $(JOBS) install

tk$(TCLVER)/unix/Makefile :
	@echo ""
	@echo "*** Configure tk$(TCLVER) ***"
	cd tk$(TCLVER)/unix; \
	./configure \
	$(TKFLAGS) \
	--prefix $(prefix) --exec-prefix $(exec_prefix) --libdir $(libdir) \
	--disable-shared --enable-symbols \
	--config-cache --cache-file=$(prefix)/config.cache

#--------------------------clean

.PHONY	: tkunixclean

tkunixclean :

#--------------------------distclean

.PHONY	: tkunixdistclean

tkunixdistclean :

#--------------------------distribution

.PHONY	: dist

dist	:
	cd bin; tar cvf - ds9* | gzip > $(prefix)/dist/ds9.$(ARCH).$(DS9VERSION).tar.gz
	cd bin; tar cvf - xpa* | gzip > $(prefix)/dist/xpa.$(ARCH).$(XPAVERSION).tar.gz
