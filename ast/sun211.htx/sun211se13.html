<!DOCTYPE html> 
<html> 
<head><title>Coordinate System Networks (FrameSets)</title> 
<meta charset=utf-8/> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<link rel="stylesheet" type="text/css" href="sun211.css" /> 
 <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=MML_HTMLorMML"></script><style type="text/css">.MathJax_MathML {text-indent: 0;}</style></head><body 
>
<div class="crosslinks"><ul class='nav'> <li class="prev"> <a 
href="sun211se12.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se14.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li>
</ul></div>
<h3 class="sectionHead"><span class="titlemark">13    </span> <a 
 id="x14-12200013"></a>Coordinate System Networks (FrameSets)</h3>
<div class="sectionTOCS">
&#x00A0;<span class="subsectionToc" >13.1 <a 
href="#x14-1230001">The FrameSet Model</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.2 <a 
href="#x14-1240002">Creating a FrameSet</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.3 <a 
href="#x14-1250003">Adding New Frames to a FrameSet</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.4 <a 
href="#x14-1260004">The Base and Current Frames</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.5 <a 
href="#x14-1270005">Referring to the Base and Current Frames</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.6 <a 
href="#x14-1280006">Using a FrameSet as a Mapping</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.7 <a 
href="#x14-1290007">Extracting a Mapping from a FrameSet</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.8 <a 
href="#x14-1300008">Using a FrameSet as a Frame</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.9 <a 
href="#x14-1310009">Extracting a Frame from a FrameSet</a></span>
<br />&#x00A0;<span class="subsectionToc" >13.10 <a 
href="#x14-13200010">Removing a Frame from a FrameSet</a></span>
</div>
<!--l. 6474--><p class="noindent" >We saw in &#x00A7;<a 
href="sun211se12.html#x13-11500012">12<!--tex4ht:ref: ss:introducingconversion --></a> how <a 
href="sun211ss32.html#x57-2490000">astConvert</a> could be used to find a <a 
href="sun211ss459.html#x486-6780000">Mapping</a> that inter-relates a pair of coordinate
systems represented by Frames. There is a limitation to this, however, in that it can only be
applied to coordinate systems that are inter-related by suitable conventions. In the case of
celestial coordinates, the relevant conventions are standards set out by the International
Astronomical Union, and others, that define what these coordinate systems mean. In practice,
however, the relationships between many other coordinate systems are also of practical
importance.
<!--l. 6484--><p class="noindent" >Consider, for example, the focal plane of a telescope upon which an image of the sky is
falling. We could measure positions in this focal plane in millimetres or, if there were a
detector system such as a CCD present, we could count pixels. We could also use celestial
coordinates of many different kinds. All of these systems are equivalent in their effectiveness at
specifying positions in the focal plane, but some are more convenient than others for particular
purposes.
<!--l. 6493--><p class="noindent" >Although we could, in principle, convert between all of these focal plane coordinate systems, there is
no pre-defined convention for doing so. This is because the conversions required depend on where the
                                                                                       

                                                                                       
telescope is pointing and how the CCD is mounted in the focal plane. Clearly, knowledge about this
cannot be built into the AST library and must be supplied in some other way. Note that this is exactly
the same problem as we met in &#x00A7;<a 
href="sun211se7.html#x8-8500012">7.12<!--tex4ht:ref: ss:framedomains --></a> when discussing the <a 
href="sun211ss279.html#x305-4970000">Domain</a> attribute&#x2014;<em>i.e.</em>&#x00A0;coordinate systems
that apply to different physical domains require that extra information be supplied before we can
convert between them.
<!--l. 6504--><p class="noindent" >What we need, therefore, is a general way to describe how coordinate systems are inter-related, so that
when there is no convention already in place, we can define our own. We can then look forward to
converting, say, from pixels into galactic coordinates and <em>vice versa.</em> In AST, the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> class
provides this capability.
<a 
 id="x14-122001r133"></a>
<h4 class="subsectionHead"><span class="titlemark">13.1    </span> <a 
 id="x14-1230001"></a>The FrameSet Model</h4>
<!--l. 6512--><p class="noindent" >Consider a coordinate system (call it number 1) which is represented by a <a 
href="sun211ss452.html#x479-6710000">Frame</a> of some kind. Now
consider a <a 
href="sun211ss459.html#x486-6780000">Mapping</a> which, when applied to the coordinates in system 1 yields coordinates in
another system, number 2. The Mapping therefore inter-relates coordinate systems 1 and
2.
<!--l. 6518--><p class="noindent" >Now consider a second Mapping which inter-relates system 1 and a further coordinate system,
number 3. If we wanted to convert coordinates between systems 2 and 3, we could do so
by:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  (1) </dt><dd 
class="enumerate-enumitem">Applying our first Mapping in reverse, so as to convert between systems 2 and 1.
     </dd><dt class="enumerate-enumitem">
  (2) </dt><dd 
class="enumerate-enumitem">Applying the second Mapping, as given, to convert between systems 1 and 3.</dd></dl>
<!--l. 6530--><p class="noindent" >We are not limited to three coordinate systems, of course. In fact, we could continue to introduce any
number of further coordinate systems, so long as we have a suitable Mapping for each one which
relates it to one of the Frames already present. Continuing in this way, we can build up a network in
which Frames are inter-related by Mappings in such a way that there is always a way of converting
between any pair of coordinate systems.
<!--l. 6538--><p class="noindent" >The <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> (Figure&#x00A0;<a 
href="sun211se2.html#x3-120017">7<!--tex4ht:ref: fig:frameset --></a>) encapsulates these ideas. It is a network composed of Frames and
associated Mappings, in which there is always exactly one path, <em>via</em> Mappings, between any
pair of Frames. Since we assemble FrameSets ourselves, they can be used to represent any
coordinate systems we choose and to set up the particular relationships between them that we
want.
<a 
 id="x14-123003r135"></a>
<h4 class="subsectionHead"><span class="titlemark">13.2    </span> <a 
 id="x14-1240002"></a>Creating a FrameSet</h4>
<!--l. 6547--><p class="noindent" >Before we can create a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, we must have a <a 
href="sun211ss452.html#x479-6710000">Frame</a> of some kind to put into it, so let&#x2019;s create a
simple one:
<div class="fancyvrb" id="fancyvrb138"> <a 
 id="x14-124002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x0022;ast.h&#x0022;<br class="fancyvrb" /><a 
 id="x14-124004r2"></a>&#x00A0;&#x00A0;AstFrame&#x00A0;*frame1;<br class="fancyvrb" /><a 
 id="x14-124006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-124008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-124010r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-124012r6"></a>&#x00A0;&#x00A0;frame1&#x00A0;=&#x00A0;astFrame(&#x00A0;2,&#x00A0;&#x0022;Domain=A&#x0022;&#x00A0;);</div>
<!--l. 6561--><p class="noindent" >We have set this Frame&#x2019;s <a 
href="sun211ss279.html#x305-4970000">Domain</a> attribute (&#x00A7;<a 
href="sun211se7.html#x8-8500012">7.12<!--tex4ht:ref: ss:framedomains --></a>) to A so that it will be distinct from the
others we will be using. We can now create a new FrameSet containing just this Frame, as
follows:
                                                                                       

                                                                                       
<div class="fancyvrb" id="fancyvrb139"> <a 
 id="x14-124014r1"></a>&#x00A0;&#x00A0;AstFrameSet&#x00A0;*frameset;<br class="fancyvrb" /><a 
 id="x14-124016r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-124018r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-124020r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-124022r5"></a>&#x00A0;&#x00A0;frameset&#x00A0;=&#x00A0;astFrameSet(&#x00A0;frame1,&#x00A0;&#x0022;&#x0022;&#x00A0;);</div>
<!--l. 6575--><p class="noindent" >So far, however, this Frame isn&#x2019;t related to any others.
<a 
 id="x14-124023r136"></a>
<h4 class="subsectionHead"><span class="titlemark">13.3    </span> <a 
 id="x14-1250003"></a>Adding New Frames to a FrameSet</h4>
<!--l. 6579--><p class="noindent" >We can now add further Frames to the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> created above (&#x00A7;<a 
href="#x14-1240002">13.2<!--tex4ht:ref: ss:creatingaframeset --></a>). To do so, we must
supply a new <a 
href="sun211ss452.html#x479-6710000">Frame</a> and an associated <a 
href="sun211ss459.html#x486-6780000">Mapping</a> that relates it to any of the Frames that are
already present (there is only one present so far). To keep the example simple, we will just
use a <a 
href="sun211ss500.html#x527-7190000">ZoomMap</a> that multiplies coordinates by 10. The required Objects are created as
follows:
<div class="fancyvrb" id="fancyvrb140"> <a 
 id="x14-125002r1"></a>&#x00A0;&#x00A0;AstFrame&#x00A0;*frame2;<br class="fancyvrb" /><a 
 id="x14-125004r2"></a>&#x00A0;&#x00A0;AstMapping&#x00A0;*mapping12;<br class="fancyvrb" /><a 
 id="x14-125006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-125008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-125010r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-125012r6"></a>&#x00A0;&#x00A0;frame2&#x00A0;=&#x00A0;astFrame(&#x00A0;2,&#x00A0;&#x0022;Domain=B&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x14-125014r7"></a>&#x00A0;&#x00A0;mapping12&#x00A0;=&#x00A0;astZoomMap(&#x00A0;2,&#x00A0;10.0,&#x00A0;&#x0022;&#x0022;&#x00A0;);</div>
<!--l. 6598--><p class="noindent" >To add the new Frame into our FrameSet, we use the <a 
href="sun211ss3.html#x28-2200000">astAddFrame</a> function:
<div class="fancyvrb" id="fancyvrb141"> <a 
 id="x14-125016r1"></a>&#x00A0;&#x00A0;astAddFrame(&#x00A0;frameset,&#x00A0;1,&#x00A0;mapping12,&#x00A0;frame2&#x00A0;);</div>
<!--l. 6607--><p class="noindent" >Whenever a Frame is added to a FrameSet, it is assigned an integer index. This index starts with 1 for
the initial Frame used to create the FrameSet (&#x00A7;<a 
href="#x14-1240002">13.2<!--tex4ht:ref: ss:creatingaframeset --></a>) and increments by one every time a
new Frame is added. This index is the primary way of identifying the Frames within a
FrameSet.
<!--l. 6613--><p class="noindent" >When a Frame is added, we also have to specify which of the existing ones the new Frame is related
to. Here, we chose number 1, the only one present so far, and the new one we added became number
2.
<!--l. 6617--><p class="noindent" >Note that a FrameSet does not make copies of the Frames and Mappings that you insert into it.
Instead, it holds pointers to them. This means that if you retain the original pointers to these Objects
and alter them, you will indirectly be altering the FrameSet&#x2019;s contents. You can, of course,
always use <a 
href="sun211ss34.html#x59-2510000">astCopy</a> (&#x00A7;<a 
href="sun211se4.html#x5-4900013">4.13<!--tex4ht:ref: ss:copyingobjects --></a>) to make a separate copy of any <a 
href="sun211ss464.html#x491-6830000">Object</a> if you need to ensure its
independence.
<!--l. 6625--><p class="noindent" >We could also add a third Frame into our FrameSet, this time defining a coordinate system which is
reached by multiplying the original coordinates (of &#x201C;frame1&#x201D;) by 5:
<div class="fancyvrb" id="fancyvrb142"> <a 
 id="x14-125018r1"></a>&#x00A0;&#x00A0;astAddFrame(&#x00A0;frameset,&#x00A0;1,&#x00A0;astZoomMap(&#x00A0;2,&#x00A0;5.0,&#x00A0;&#x0022;&#x0022;&#x00A0;),&#x00A0;astFrame(&#x00A0;2,&#x00A0;&#x0022;Domain=C&#x0022;&#x00A0;)&#x00A0;);</div>
<!--l. 6635--><p class="noindent" >Here, we have avoided storing unnecessary pointer values by using function invocations directly as
arguments for astAddFrame. This assumes that we are using <a 
href="sun211ss13.html#x38-2300000">astBegin</a> and <a 
href="sun211ss47.html#x72-2640000">astEnd</a> (&#x00A7;<a 
href="sun211se4.html#x5-4400010">4.10<!--tex4ht:ref: ss:contexts --></a>) to ensure
that Objects are correctly deleted when no longer required.
<!--l. 6640--><p class="noindent" >Our example FrameSet now contains three Frames and two Mappings with the arrangement shown in
Figure&#x00A0;<a 
href="#x14-12501911">11<!--tex4ht:ref: fig:fsexample --></a>. <hr class="figure"><div class="figure" 
>
                                                                                       

                                                                                       
<a 
 id="x14-12501911"></a>
                                                                                       

                                                                                       
<div class="center">
<img 
src="sun211_figures/fsexample.png" alt="pdfpict"  
 width="70%" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;11:  </span><span  
class="content">An  example  FrameSet,  in  which  Frames&#x00A0;2  and  3  are  related  to  Frame&#x00A0;1  by
multiplying its coordinates by factors of 10 and 5 respectively. The FrameSet&#x2019;s <a 
href="sun211ss252.html#x278-4700000">Base</a> attribute
has the value 1 and its <a 
href="sun211ss273.html#x299-4910000">Current</a> attribute has the value 3. The transformation performed when
the FrameSet is used as a Mapping (<em>i.e.</em>&#x00A0;from its base to its current Frame) is shown in bold.</span></div><!--tex4ht:label?: x14-12501911 -->
</div>
                                                                                       

                                                                                       
<!--l. 6653--><p class="noindent" ></div><hr class="endfigure">
<!--l. 6654--><p class="noindent" >The total number of Frames is given by its read-only <a 
href="sun211ss352.html#x378-5700000">Nframe</a> attribute.
<a 
 id="x14-125020r137"></a>
<h4 class="subsectionHead"><span class="titlemark">13.4    </span> <a 
 id="x14-1260004"></a>The Base and Current Frames</h4>
<!--l. 6658--><p class="noindent" >At all times, one of the Frames in a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> is designated to be its <em>base</em> <a 
href="sun211ss452.html#x479-6710000">Frame</a> and one
to be its <em>current</em> Frame (Figure&#x00A0;<a 
href="#x14-12501911">11<!--tex4ht:ref: fig:fsexample --></a>). These Frames are identified by two integer FrameSet
attributes, <a 
href="sun211ss252.html#x278-4700000">Base</a> and <a 
href="sun211ss273.html#x299-4910000">Current</a>, which hold the indices of the nominated Frames within the
FrameSet.
<!--l. 6664--><p class="noindent" >The existence of the base and current Frames reflects an important application of FrameSets, which is
to attach coordinate systems to entities such as data arrays, data files, plotting surfaces (for graphics),
<em>etc.</em> In this context, the base Frame represents the &#x201C;native&#x201D; coordinate system of the attached
entity&#x2014;for example, the pixel coordinates of an image or the intrinsic coordinates of a plotting
surface. The other Frames within the FrameSet represent alternative coordinate systems which may
also be used to refer to positions within that entity. The current Frame represents the particular
coordinate system which is currently selected for use. For instance, if an image were being displayed,
you would aim to label it with coordinates corresponding to the current Frame. In order to see a
different coordinate system, a software user would arrange for a different Frame to be made
current.
<!--l. 6679--><p class="noindent" >The choice of base and current Frames may be changed at any time, simply by assigning new values
to the FrameSet&#x2019;s Base and Current attributes. For example, to make the Frame with index 3 become
the current Frame, you could use:
<div class="fancyvrb" id="fancyvrb143"> <a 
 id="x14-126002r1"></a>&#x00A0;&#x00A0;astSetI(&#x00A0;frameset,&#x00A0;&#x0022;Current&#x0022;,&#x00A0;3&#x00A0;);</div>
<!--l. 6690--><p class="noindent" >You can nominate the same Frame to be both the base and current Frame if you wish.
<!--l. 6694--><p class="noindent" >By default (<em>i.e.</em>&#x00A0;if the Base or Current attribute is un-set), the first Frame added to
a FrameSet becomes its base Frame and the last one added becomes its current
Frame.<span class="footnote-mark"><a 
href="#fn21x0" id="fn21x0-bk"><sup class="textsuperscript">21</sup></a></span><a 
 id="x14-126003f21"></a>
Whenever a new Frame is added to a FrameSet, the Current attribute is modified so that the new
Frame becomes the current one. This behaviour is reflected in the state of the example FrameSet in
Figure&#x00A0;<a 
href="#x14-12501911">11<!--tex4ht:ref: fig:fsexample --></a>.
<a 
 id="x14-126004r139"></a>
<h4 class="subsectionHead"><span class="titlemark">13.5    </span> <a 
 id="x14-1270005"></a>Referring to the Base and Current Frames</h4>
<!--l. 6705--><p class="noindent" >It is often necessary to refer to the base and current Frames (&#x00A7;<a 
href="#x14-1260004">13.4<!--tex4ht:ref: ss:baseandcurrent --></a>) within a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, but it can be
cumbersome having to obtain their indices from the <a 
href="sun211ss252.html#x278-4700000">Base</a> and <a 
href="sun211ss273.html#x299-4910000">Current</a> attributes on each occasion. To
make this easier, two macros, AST__BASE and AST__CURRENT, are defined in the &#x201C;ast.h&#x201D; header file
and may be used to represent the indices of the base and current Frames respectively. They may be
used whenever a <a 
href="sun211ss452.html#x479-6710000">Frame</a> index is required.
<!--l. 6714--><p class="noindent" >For example, when adding a new Frame to a FrameSet (&#x00A7;<a 
href="#x14-1250003">13.3<!--tex4ht:ref: ss:addingframes --></a>), you could use the following to indicate
that the new Frame is related to the existing current Frame, whatever its index happens to
be:
                                                                                       

                                                                                       
<div class="fancyvrb" id="fancyvrb144"> <a 
 id="x14-127002r1"></a>&#x00A0;&#x00A0;AstFrame&#x00A0;*frame;<br class="fancyvrb" /><a 
 id="x14-127004r2"></a>&#x00A0;&#x00A0;AstMapping&#x00A0;*mapping;<br class="fancyvrb" /><a 
 id="x14-127006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-127008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-127010r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-127012r6"></a>&#x00A0;&#x00A0;astAddFrame(&#x00A0;frameset,&#x00A0;AST__CURRENT,&#x00A0;mapping,&#x00A0;frame&#x00A0;);</div>
<!--l. 6730--><p class="noindent" >Of course, the Frame you added would then become the new current Frame.
<a 
 id="x14-127013r140"></a>
<h4 class="subsectionHead"><span class="titlemark">13.6    </span> <a 
 id="x14-1280006"></a>Using a FrameSet as a Mapping</h4>
<!--l. 6735--><p class="noindent" >The <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> class inherits properties and behaviour from the <a 
href="sun211ss452.html#x479-6710000">Frame</a> class (&#x00A7;<a 
href="sun211se7.html#x8-730007">7<!--tex4ht:ref: ss:frames --></a>) and, in
turn, from the <a 
href="sun211ss459.html#x486-6780000">Mapping</a> class (&#x00A7;<a 
href="sun211se5.html#x6-530005">5<!--tex4ht:ref: ss:mappings --></a>). Its behaviour when used as a Mapping is particularly
important.
<!--l. 6740--><p class="noindent" >Consider, for instance, passing a FrameSet pointer to a coordinate transformation function such as
<a 
href="sun211ss219.html#x244-4360000">astTran2</a>:
<div class="fancyvrb" id="fancyvrb145"> <a 
 id="x14-128002r1"></a>&#x00A0;&#x00A0;#define&#x00A0;N&#x00A0;10<br class="fancyvrb" /><a 
 id="x14-128004r2"></a>&#x00A0;&#x00A0;double&#x00A0;xin[&#x00A0;N&#x00A0;],&#x00A0;yin[&#x00A0;N&#x00A0;],&#x00A0;xout[&#x00A0;N&#x00A0;],&#x00A0;yout[&#x00A0;N&#x00A0;];<br class="fancyvrb" /><a 
 id="x14-128006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-128008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-128010r5"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x14-128012r6"></a>&#x00A0;&#x00A0;astTran2(&#x00A0;frameset,&#x00A0;N,&#x00A0;xin,&#x00A0;yin,&#x00A0;1,&#x00A0;xout,&#x00A0;yout&#x00A0;);</div>
<!--l. 6754--><p class="noindent" >The coordinate transformation applied by this FrameSet would be the one which converts between its
base and current Frames. Using the FrameSet in Figure&#x00A0;<a 
href="#x14-12501911">11<!--tex4ht:ref: fig:fsexample --></a>, for example, the coordinates would be
multiplied by a factor of 5. If we instead requested the FrameSet&#x2019;s inverse transformation, we would
be transforming from its current Frame to its base Frame, so our example FrameSet would then
multiply by a factor of 0.2.
<!--l. 6762--><p class="noindent" >Whenever the choice of base and current Frames changes, the transformations which a FrameSet
performs when used as a Mapping also change to reflect this. The <a 
href="sun211ss353.html#x379-5710000">Nin</a> and <a 
href="sun211ss359.html#x385-5770000">Nout</a> attributes may also
change in consequence, because they are determined by the numbers of axes in the FrameSet&#x2019;s
base and current Frames respectively. These numbers need not necessarily be equal, of
course.
<!--l. 6769--><p class="noindent" >Like any Mapping, a FrameSet may also be inverted by changing the boolean sense of its <a 
href="sun211ss312.html#x338-5300000">Invert</a>
attribute, <em>e.g.</em>&#x00A0;using <a 
href="sun211ss94.html#x119-3110000">astInvert</a> (&#x00A7;<a 
href="sun211se5.html#x6-590006">5.6<!--tex4ht:ref: ss:invertingmappings --></a>). If this is happens, the values of the FrameSet&#x2019;s <a 
href="sun211ss252.html#x278-4700000">Base</a> and <a 
href="sun211ss273.html#x299-4910000">Current</a>
attributes are interchanged, along with its Nin and Nout attributes, so that its base and current Frames
swap places. When used as a Mapping, the FrameSet will therefore perform the inverse
transformation to that which it performed previously.
<!--l. 6777--><p class="noindent" >To summarise, a FrameSet may be used exactly like any other Mapping which inter-relates the
coordinate systems described by its base and current Frames.
<a 
 id="x14-128013r141"></a>
<h4 class="subsectionHead"><span class="titlemark">13.7    </span> <a 
 id="x14-1290007"></a>Extracting a Mapping from a FrameSet</h4>
<!--l. 6783--><p class="noindent" >Although it is very convenient to use a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> when a <a 
href="sun211ss459.html#x486-6780000">Mapping</a> is required (&#x00A7;<a 
href="#x14-1280006">13.6<!--tex4ht:ref: ss:framesetasmapping --></a>), a FrameSet
necessarily contains additional information and sometimes this might cause inefficiency or confusion.
For example, if you wanted to use a Mapping contained in one FrameSet and insert it into another, it
would probably not be efficient to insert the whole of the first FrameSet into the second one, although
it would work.
<!--l. 6791--><p class="noindent" >In such a situation, the <a 
href="sun211ss67.html#x92-2840000">astGetMapping</a> function allows you to extract a Mapping from a FrameSet.
You do this by specifying the two Frames which the Mapping should inter-relate using their indices
within the FrameSet. For example:
<div class="fancyvrb" id="fancyvrb146"> <a 
 id="x14-129002r1"></a>&#x00A0;&#x00A0;map&#x00A0;=&#x00A0;astGetMapping(&#x00A0;frameset,&#x00A0;2,&#x00A0;3&#x00A0;);</div>
                                                                                       

                                                                                       
<!--l. 6802--><p class="noindent" >would return a pointer to a Mapping that converted between Frames&#x00A0;2 and 3 in the FrameSet. Its
inverse transformation would then convert in the opposite direction, <em>i.e.</em>&#x00A0;between Frames&#x00A0;3 and 2.
Note that this Mapping might not be independent of the Mappings contained within the
FrameSet&#x2014;<em>i.e.</em>&#x00A0;they may share sub-Objects&#x2014;so <a 
href="sun211ss34.html#x59-2510000">astCopy</a> should be used to make a copy if you need to
guarantee independence (&#x00A7;<a 
href="sun211se4.html#x5-4900013">4.13<!--tex4ht:ref: ss:copyingobjects --></a>).
<!--l. 6810--><p class="noindent" >Very often, the Mapping returned by astGetMapping will be a compound Mapping, or <a 
href="sun211ss444.html#x471-6630000">CmpMap</a> (&#x00A7;<a 
href="sun211se6.html#x7-650006">6<!--tex4ht:ref: ss:cmpmaps --></a>).
This reflects the fact that conversion between the two Frames may need to be done <em>via</em> an
intermediate coordinate system so that several stages may be involved. You can, however,
easily simplify this Mapping (where this is possible) by using the <a 
href="sun211ss190.html#x215-4070000">astSimplify</a> function
(&#x00A7;<a 
href="sun211se6.html#x7-720007">6.7<!--tex4ht:ref: ss:simplifyingcmpmaps --></a>) and this is recommended if you plan to use it for transforming a large amount of
data.
<a 
 id="x14-129003r142"></a>
<h4 class="subsectionHead"><span class="titlemark">13.8    </span> <a 
 id="x14-1300008"></a>Using a FrameSet as a Frame</h4>
<!--l. 6821--><p class="noindent" >A <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> can also be used as a <a 
href="sun211ss452.html#x479-6710000">Frame</a>, in which capacity it almost always behaves as if its current
Frame had been used instead. For example, if you request the <a 
href="sun211ss420.html#x446-6380000">Title</a> attribute of a FrameSet
using:
<div class="fancyvrb" id="fancyvrb147"> <a 
 id="x14-130002r1"></a>&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*title;<br class="fancyvrb" /><a 
 id="x14-130004r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-130006r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x14-130008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x14-130010r5"></a>&#x00A0;&#x00A0;title&#x00A0;=&#x00A0;astGetC(&#x00A0;frameset,&#x00A0;&#x0022;Title&#x0022;&#x00A0;);</div>
<!--l. 6835--><p class="noindent" >the result will be the Title of the current Frame, or a suitable default if the current Frame&#x2019;s Title
attribute is un-set. The same also applies to other attribute operations&#x2014;<em>i.e.</em>&#x00A0;setting, clearing and
testing attributes. Most attributes shared by both Frames and FrameSets behave in this way, such as
<a 
href="sun211ss347.html#x373-5650000">Naxes</a>, <a 
href="sun211ss323.html#x349-5410000">Label(axis)</a>, <a 
href="sun211ss292.html#x318-5100000">Format(axis)</a>, <em>etc.</em> There are, however, a few exceptions:
     <div class="quote">
     <dl class="description"><dt class="description">
<a 
href="sun211ss262.html#x288-4800000">Class</a> </dt><dd 
class="description"><br 
class="newline" />Has the value &#x201C;FrameSet&#x201D;.
     </dd><dt class="description">
<a 
href="sun211ss305.html#x331-5230000">ID</a> </dt><dd 
class="description"><br 
class="newline" />Identifies the particular FrameSet (not its current Frame).
     </dd><dt class="description">
<a 
href="sun211ss353.html#x379-5710000">Nin</a> </dt><dd 
class="description"><br 
class="newline" />Equals the number of axes in the FrameSet&#x2019;s base Frame.
     </dd><dt class="description">
<a 
href="sun211ss312.html#x338-5300000">Invert</a> </dt><dd 
class="description"><br 
class="newline" />Is independent of any of the Objects within the FrameSet.
     </dd><dt class="description">
<a 
href="sun211ss356.html#x382-5740000">Nobject</a> </dt><dd 
class="description"><br 
class="newline" />Counts the number of active FrameSets.
     </dd><dt class="description">
<a 
href="sun211ss377.html#x403-5950000">RefCount</a> </dt><dd 
class="description"><br 
class="newline" />Counts the number of active pointers to the FrameSet (not to its current Frame).</dd></dl>
                                                                                       

                                                                                       
     </div>
<!--l. 6865--><p class="noindent" >Note that the set of attributes possessed by a FrameSet can vary, depending on the nature of its current
Frame. For example, if the current Frame is a <a 
href="sun211ss478.html#x505-6970000">SkyFrame</a> (&#x00A7;<a 
href="sun211se8.html#x9-900008">8<!--tex4ht:ref: ss:skyframes --></a>), then the FrameSet will acquire an
<a 
href="sun211ss286.html#x312-5040000">Equinox</a> attribute from it which can be set, enquired, <em>etc.</em> However, if the current Frame is changed
to be a basic Frame, which does not have an Equinox attribute, then this attribute will
be absent from the FrameSet as well. Any attempt to reference it will then result in an
error.
<a 
 id="x14-130011r143"></a>
<h4 class="subsectionHead"><span class="titlemark">13.9    </span> <a 
 id="x14-1310009"></a>Extracting a Frame from a FrameSet</h4>
<!--l. 6876--><p class="noindent" >Although a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> may be used in place of its current <a 
href="sun211ss452.html#x479-6710000">Frame</a> in most situations, it is sometimes
convenient to have direct access to a specified Frame within it. This may be obtained using the
<a 
href="sun211ss65.html#x90-2820000">astGetFrame</a> function, as follows:
<div class="fancyvrb" id="fancyvrb148"> <a 
 id="x14-131002r1"></a>&#x00A0;&#x00A0;frame&#x00A0;=&#x00A0;astGetFrame(&#x00A0;frameset,&#x00A0;AST__BASE&#x00A0;);</div>
<!--l. 6887--><p class="noindent" >This would return a pointer (not a copy) to the base Frame within the FrameSet. Note the use of
AST__BASE (&#x00A7;<a 
href="#x14-1270005">13.5<!--tex4ht:ref: ss:astbaseandastcurrent --></a>) as shorthand for the value of the FrameSet&#x2019;s <a 
href="sun211ss252.html#x278-4700000">Base</a> attribute, which gives the base
Frame&#x2019;s index.
<a 
 id="x14-131003r144"></a>
<h4 class="subsectionHead"><span class="titlemark">13.10    </span> <a 
 id="x14-13200010"></a>Removing a Frame from a FrameSet</h4>
<!--l. 6894--><p class="noindent" >Removing a <a 
href="sun211ss452.html#x479-6710000">Frame</a> from a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> is straightforward and is performed using the <a 
href="sun211ss167.html#x192-3840000">astRemoveFrame</a>
function. You identify the Frame you wish to remove in the usual way, by giving its index
within the FrameSet. For example, the following would remove the Frame with index
1:
<div class="fancyvrb" id="fancyvrb149"> <a 
 id="x14-132002r1"></a>&#x00A0;&#x00A0;astRemoveFrame(&#x00A0;frameset,&#x00A0;1&#x00A0;);</div>
<!--l. 6905--><p class="noindent" >The only restriction is that you cannot remove the last remaining Frame because a FrameSet must
always contain at least one Frame. When a Frame is removed, the Frames which follow it are
re-numbered (<em>i.e.</em>&#x00A0;their indices are reduced by one) so as to preserve the sequence of consecutive
Frame indices. The FrameSet&#x2019;s <a 
href="sun211ss352.html#x378-5700000">Nframe</a> attribute is also decremented.
<!--l. 6912--><p class="noindent" >If appropriate, astRemoveFrame will modify the FrameSet&#x2019;s <a 
href="sun211ss252.html#x278-4700000">Base</a> and/or <a 
href="sun211ss273.html#x299-4910000">Current</a> attributes so that
they continue to identify the same Frames as previously. If either the base or current Frame is
removed, however, the corresponding attribute will become un-set, so that it reverts to its default
value (&#x00A7;<a 
href="#x14-1260004">13.4<!--tex4ht:ref: ss:baseandcurrentdefault --></a>) and therefore identifies an alternative Frame.
<!--l. 6919--><p class="noindent" >Note that it is quite permissible to remove any Frame from a FrameSet, even although other Frames
may appear to depend on it. For example, in Figure&#x00A0;<a 
href="#x14-12501911">11<!--tex4ht:ref: fig:fsexample --></a>, if Frame&#x00A0;1 were removed, the correct
relationship between Frames&#x00A0;2 and 3 would still be preserved, although they would be re-numbered
as Frames&#x00A0;1 and 2.
                                                                                       

                                                                                       
                                                                                       

                                                                                       
<div class="footnotes"><!--l. 6697--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn21x0-bk" id="fn21x0"><sup class="textsuperscript">21</sup></a></span>Although this is reversed if the FrameSet&#x2019;s <a 
href="sun211ss312.html#x338-5300000">Invert</a> attribute is non-zero.                              </div> <div class="crosslinks">
<div class="copyright"><span class="pushright">Copyright (C) 2014 Science &#x0026; Technology Facilities Council</span></div> <ul class='nav'> <li class="prev"> <a 
href="sun211se12.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World
Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se14.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li> </ul></div>
<!--l. 6926--><p class="noindent" ><a 
 id="tailsun211se13.html"></a> 
</body> 
</html>