<!DOCTYPE html> 
<html> 
<head><title>How To&#x2026;</title> 
<meta charset=utf-8/> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<link rel="stylesheet" type="text/css" href="sun211.css" /> 
 <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=MML_HTMLorMML"></script><style type="text/css">.MathJax_MathML {text-indent: 0;}</style></head><body 
>
<div class="crosslinks"><ul class='nav'> <li class="prev"> <a 
href="sun211se2.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se4.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li>
</ul></div>
<h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x4-150003"></a>How To&#x2026;</h3>
<div class="sectionTOCS">
&#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x4-160001">&#x2026;Obtain and Install AST</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x4-170002">&#x2026;Structure an AST Program</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.3 <a 
href="#x4-180003">&#x2026;Build an AST Program</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.4 <a 
href="#x4-190004">&#x2026;Read a WCS Calibration from a Dataset</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.5 <a 
href="#x4-200005">&#x2026;Validate WCS Information</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.6 <a 
href="#x4-210006">&#x2026;Display AST Data</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.7 <a 
href="#x4-220007">&#x2026;Convert Between Pixel and World Coordinates</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.8 <a 
href="#x4-230008">&#x2026;Test if a WCS is a Celestial Coordinate System</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.9 <a 
href="#x4-240009">&#x2026;Test if a WCS is a Spectral Coordinate System</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.10 <a 
href="#x4-2500010">&#x2026;Format Coordinates for Display</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.11 <a 
href="#x4-2600011">&#x2026;Display Coordinates as they are Transformed</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.12 <a 
href="#x4-2700012">&#x2026;Read Coordinates Entered by a User</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.13 <a 
href="#x4-2800013">&#x2026;Create a New WCS Calibration</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.14 <a 
href="#x4-2900014">&#x2026;Modify a WCS Calibration</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.15 <a 
href="#x4-3000015">&#x2026;Write a Modified WCS Calibration to a Dataset</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.16 <a 
href="#x4-3100016">&#x2026;Display a Graphical Coordinate Grid</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.17 <a 
href="#x4-3200017">&#x2026;Switch to Plot a Different Celestial Coordinate Grid</a></span>
<br />&#x00A0;<span class="subsectionToc" >3.18 <a 
href="#x4-3300018">&#x2026;Give a User Control Over the Appearance of a Plot</a></span>
</div>
<!--l. 637--><p class="noindent" >For those of you with a plane to catch, this section provides some instant templates and recipes for
                                                                                       

                                                                                       
performing the most commonly-required operations using AST, but without going into detail. The
examples given (sort of) follow on from each other, so you should be able to construct a variety of
programs by piecing them together. Note that some of them appear longer than they actually are,
because we have included plenty of comments and a few options that you probably won&#x2019;t
need.
<!--l. 646--><p class="noindent" >If any of this material has you completely baffled, then you may want to read the introduction to AST
programming concepts in &#x00A7;<a 
href="sun211se4.html#x5-340004">4<!--tex4ht:ref: ss:primer --></a> first. Otherwise, references to more detailed reading are given after each
example, just in case they don&#x2019;t quite do what you want.
<a 
 id="x4-15001r23"></a>
<h4 class="subsectionHead"><span class="titlemark">3.1    </span> <a 
 id="x4-160001"></a>&#x2026;Obtain and Install AST</h4>
<!--l. 653--><p class="noindent" >The AST library is available both as a stand-alone package and also as part of the Starlink Software
Collection<span class="footnote-mark"><a 
href="#fn4x0" id="fn4x0-bk"><sup class="textsuperscript">4</sup></a></span><a 
 id="x4-16001f4"></a>.
If your site has the Starlink Software Collection installed then AST should already be available.
<!--l. 659--><p class="noindent" >If not, you can download the AST library by itself from <a 
href="http://www.starlink.ac.uk/ast/" class="url" >http://www.starlink.ac.uk/ast/</a>.
<a 
 id="x4-16002r26"></a>
<h4 class="subsectionHead"><span class="titlemark">3.2    </span> <a 
 id="x4-170002"></a>&#x2026;Structure an AST Program</h4>
<!--l. 664--><p class="noindent" >An AST program normally has the following structure:
<!--l. 666--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb2"> <a 
 id="x4-17002r1"></a>&#x00A0;&#x00A0;/*&#x00A0;Include&#x00A0;the&#x00A0;interface&#x00A0;to&#x00A0;the&#x00A0;AST&#x00A0;library.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-17004r2"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x0022;ast.h&#x0022;<br class="fancyvrb" /><a 
 id="x4-17006r3"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-17008r4"></a>&#x00A0;&#x00A0;/*&#x00A0;Main&#x00A0;program&#x00A0;(or&#x00A0;could&#x00A0;be&#x00A0;any&#x00A0;function).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-17010r5"></a>&#x00A0;&#x00A0;main&#x00A0;()&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-17012r6"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;normal&#x00A0;C&#x00A0;declarations&#x00A0;and&#x00A0;statements&#x003E;
<br class="fancyvrb" /><a 
 id="x4-17014r7"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-17016r8"></a>&#x00A0;&#x00A0;/*&#x00A0;Enclose&#x00A0;the&#x00A0;parts&#x00A0;which&#x00A0;use&#x00A0;AST&#x00A0;between&#x00A0;the&#x00A0;astBegin&#x00A0;and&#x00A0;astEnd&#x00A0;macros.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-17018r9"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astBegin;<br class="fancyvrb" /><a 
 id="x4-17020r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;C&#x00A0;statements&#x00A0;which&#x00A0;use&#x00A0;AST&#x003E;<br class="fancyvrb" /><a 
 id="x4-17022r11"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astEnd;<br class="fancyvrb" /><a 
 id="x4-17024r12"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-17026r13"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;maybe&#x00A0;more&#x00A0;C&#x00A0;statements&#x003E;<br class="fancyvrb" /><a 
 id="x4-17028r14"></a>&#x00A0;&#x00A0;}</div>
<!--l. 683--><p class="noindent" ></div>
<!--l. 685--><p class="noindent" >The use of <a 
href="sun211ss13.html#x38-2300000">astBegin</a> and <a 
href="sun211ss47.html#x72-2640000">astEnd</a> is optional, but has the effect of tidying up after you have finished
using AST, so is normally recommended. For more details of this, see &#x00A7;<a 
href="sun211se4.html#x5-4400010">4.10<!--tex4ht:ref: ss:contexts --></a>. For details of how to
access the &#x201C;ast.h&#x201D; header file, see &#x00A7;<a 
href="sun211se22.html#x23-2130001">22.1<!--tex4ht:ref: ss:accessingheaderfile --></a>.
<a 
 id="x4-17029r27"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3    </span> <a 
 id="x4-180003"></a>&#x2026;Build an AST Program</h4>
<!--l. 693--><p class="noindent" >To build a simple AST program that doesn&#x2019;t use graphics, use:
<!--l. 695--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb3"> <a 
 id="x4-18002r1"></a>&#x00A0;&#x00A0;cc&#x00A0;program.c&#x00A0;-L/star/lib&#x00A0;-I/star/include&#x00A0;&#x2018;ast_link&#x2018;&#x00A0;-o&#x00A0;program</div>
<!--l. 699--><p class="noindent" ></div>
<!--l. 701--><p class="noindent" >To build a program which uses PGPLOT for graphics, use:
<!--l. 703--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb4"> <a 
 id="x4-18004r1"></a>&#x00A0;&#x00A0;cc&#x00A0;program.c&#x00A0;-L/star/lib&#x00A0;&#x2018;ast_link&#x00A0;-pgplot&#x2018;&#x00A0;-o&#x00A0;program</div>
                                                                                       

                                                                                       
<!--l. 707--><p class="noindent" ></div>
<!--l. 709--><p class="noindent" >For more details about accessing the &#x201C;ast.h&#x201D; header file, see &#x00A7;<a 
href="sun211se22.html#x23-2130001">22.1<!--tex4ht:ref: ss:accessingheaderfile --></a>. For more details about linking
programs, see &#x00A7;<a 
href="sun211se22.html#x23-2140002">22.2<!--tex4ht:ref: ss:linking --></a> and the description of the &#x201C;<a 
href="sun211ss501.html#x529-7210000">ast_link</a>&#x201D; command in Appendix&#x00A0;<a 
href="sun211se27.html#x528-7200005">E<!--tex4ht:ref: ss:commanddescriptions --></a>.
<a 
 id="x4-18005r28"></a>
<h4 class="subsectionHead"><span class="titlemark">3.4    </span> <a 
 id="x4-190004"></a>&#x2026;Read a WCS Calibration from a Dataset</h4>
<!--l. 717--><p class="noindent" >Precisely how you extract world coordinate system (WCS) information from a dataset obviously
depends on what type of dataset it is. Usually, however, you should be able to obtain a set of
FITS header cards which contain the WCS information (and probably much more besides).
Suppose that &#x201C;cards&#x201D; is a pointer to a string containing a complete set of concatenated FITS
header cards (such as produced by the CFITSIO function fits_hdr2str). Then proceed as
follows:
<!--l. 725--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb5"> <a 
 id="x4-19002r1"></a>&#x00A0;&#x00A0;fitsfile&#x00A0;*fptr;<br class="fancyvrb" /><a 
 id="x4-19004r2"></a>&#x00A0;&#x00A0;AstFitsChan&#x00A0;*fitschan;<br class="fancyvrb" /><a 
 id="x4-19006r3"></a>&#x00A0;&#x00A0;AstFrameSet&#x00A0;*wcsinfo;<br class="fancyvrb" /><a 
 id="x4-19008r4"></a>&#x00A0;&#x00A0;char&#x00A0;*header;<br class="fancyvrb" /><a 
 id="x4-19010r5"></a>&#x00A0;&#x00A0;int&#x00A0;nkeys,&#x00A0;status;
<br class="fancyvrb" /><a 
 id="x4-19012r6"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-19014r7"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-19016r8"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-19018r9"></a>&#x00A0;&#x00A0;/*&#x00A0;Obtain&#x00A0;all&#x00A0;the&#x00A0;cards&#x00A0;in&#x00A0;the&#x00A0;header&#x00A0;concatenated&#x00A0;into&#x00A0;a&#x00A0;single&#x00A0;dynamically
<br class="fancyvrb" /><a 
 id="x4-19020r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;allocated&#x00A0;null-terminated&#x00A0;character&#x00A0;string.&#x00A0;Note,&#x00A0;we&#x00A0;do&#x00A0;not&#x00A0;exclude
<br class="fancyvrb" /><a 
 id="x4-19022r11"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;any&#x00A0;cards&#x00A0;since&#x00A0;we&#x00A0;may&#x00A0;later&#x00A0;modify&#x00A0;the&#x00A0;WCS&#x00A0;information&#x00A0;within&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-19024r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;header&#x00A0;and&#x00A0;consequently&#x00A0;want&#x00A0;to&#x00A0;write&#x00A0;the&#x00A0;entire&#x00A0;header&#x00A0;out&#x00A0;again.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-19026r13"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if(&#x00A0;fits_hdr2str(&#x00A0;fptr,&#x00A0;0,&#x00A0;NULL,&#x00A0;0,&#x00A0;&#x0026;header,&#x00A0;&#x0026;nkeys,&#x00A0;&#x0026;status&#x00A0;)&#x00A0;)
<br class="fancyvrb" /><a 
 id="x4-19028r14"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;printf(&#x0022;&#x00A0;Error&#x00A0;getting&#x00A0;header&#x005C;n&#x0022;);<br class="fancyvrb" /><a 
 id="x4-19030r15"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-19032r16"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-19034r17"></a>&#x00A0;&#x00A0;/*&#x00A0;Header&#x00A0;obtained&#x00A0;succesfully...&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-19036r18"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-19038r19"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-19040r20"></a>&#x00A0;&#x00A0;/*&#x00A0;Create&#x00A0;a&#x00A0;FitsChan&#x00A0;and&#x00A0;fill&#x00A0;it&#x00A0;with&#x00A0;FITS&#x00A0;header&#x00A0;cards.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-19042r21"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;fitschan&#x00A0;=&#x00A0;astFitsChan(&#x00A0;NULL,&#x00A0;NULL,&#x00A0;&#x0022;&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-19044r22"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astPutCards(&#x00A0;fitschan,&#x00A0;header&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-19046r23"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-19048r24"></a>&#x00A0;&#x00A0;/*&#x00A0;Free&#x00A0;the&#x00A0;memory&#x00A0;holding&#x00A0;the&#x00A0;concatenated&#x00A0;header&#x00A0;cards.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-19050r25"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;header&#x00A0;=&#x00A0;free(&#x00A0;header&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-19052r26"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-19054r27"></a>&#x00A0;&#x00A0;/*&#x00A0;Read&#x00A0;WCS&#x00A0;information&#x00A0;from&#x00A0;the&#x00A0;FitsChan.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-19056r28"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;wcsinfo&#x00A0;=&#x00A0;astRead(&#x00A0;fitschan&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-19058r29"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-19060r30"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-19062r31"></a>&#x00A0;&#x00A0;</div>
<!--l. 759--><p class="noindent" ></div>
<!--l. 762--><p class="noindent" >The result should be a pointer, &#x201C;wcsinfo&#x201D;, to a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> which contains the WCS information. This
pointer can now be used to perform many useful tasks, some of which are illustrated in the following
recipes.
<!--l. 767--><p class="noindent" >Some datasets which do not easily yield FITS header cards may require a different approach, possibly
involving use of a <a 
href="sun211ss441.html#x468-6600000">Channel</a> or <a 
href="sun211ss499.html#x526-7180000">XmlChan</a> (&#x00A7;<a 
href="sun211se15.html#x16-14100015">15<!--tex4ht:ref: ss:channels --></a>) rather than a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a>. In the case of the Starlink NDF
data format, for example, all the above may be replaced by a single call to the function <a 
href="http://www.starlink.ac.uk/cgi-bin/htxserver/sun33.htx/sun33.html?xref_ndfGtwcs" >ndfGtwcs</a>&#x2014;see
<a 
href="http://www.starlink.ac.uk/cgi-bin/htxserver/sun33.htx/sun33.html?xref_" >SUN/33</a>. The whole process can probably be encapsulated in a similar way for most data systems,
whether they use FITS header cards or not.
<!--l. 776--><p class="noindent" >For more details about reading WCS information from datasets, see &#x00A7;<a 
href="sun211se17.html#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a> and &#x00A7;<a 
href="sun211se17.html#x18-1760004">17.4<!--tex4ht:ref: ss:readingforeignfits --></a>. For a more
general description of FitsChans and their use with FITS header cards, see &#x00A7;<a 
href="sun211se16.html#x17-15700016">16<!--tex4ht:ref: ss:nativefits --></a> and &#x00A7;<a 
href="sun211se17.html#x18-17200017">17<!--tex4ht:ref: ss:foreignfits --></a>. For more
details about FrameSets, see &#x00A7;<a 
href="sun211se13.html#x14-12200013">13<!--tex4ht:ref: ss:framesets --></a> and &#x00A7;<a 
href="sun211se14.html#x15-13300014">14<!--tex4ht:ref: ss:fshigher --></a>.
<a 
 id="x4-19063r29"></a>
<h4 class="subsectionHead"><span class="titlemark">3.5    </span> <a 
 id="x4-200005"></a>&#x2026;Validate WCS Information</h4>
<!--l. 785--><p class="noindent" >Once you have read WCS information from a dataset, as in &#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>, you may wish to check that you have
been successful. The following will detect and classify the things that might possibly go
wrong:
                                                                                       

                                                                                       
<!--l. 790--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb6"> <a 
 id="x4-20002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;string.h&#x003E;<br class="fancyvrb" /><a 
 id="x4-20004r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-20006r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-20008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-20010r5"></a>&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!astOK&#x00A0;)&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-20012r6"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;an&#x00A0;error&#x00A0;occurred&#x00A0;(a&#x00A0;message&#x00A0;will&#x00A0;have&#x00A0;been&#x00A0;issued)&#x003E;
<br class="fancyvrb" /><a 
 id="x4-20014r7"></a>&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;if&#x00A0;(&#x00A0;wcsinfo&#x00A0;==&#x00A0;AST__NULL&#x00A0;)&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-20016r8"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;there&#x00A0;was&#x00A0;no&#x00A0;WCS&#x00A0;information&#x00A0;present&#x003E;
<br class="fancyvrb" /><a 
 id="x4-20018r9"></a>&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;if&#x00A0;(&#x00A0;strcmp(&#x00A0;astGetC(&#x00A0;wcsinfo,&#x00A0;&#x0022;Class&#x0022;&#x00A0;),&#x00A0;&#x0022;FrameSet&#x0022;&#x00A0;)&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-20020r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;something&#x00A0;unexpected&#x00A0;was&#x00A0;read&#x00A0;(i.e.&#x00A0;not&#x00A0;a&#x00A0;FrameSet)&#x003E;<br class="fancyvrb" /><a 
 id="x4-20022r11"></a>&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-20024r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;WCS&#x00A0;information&#x00A0;was&#x00A0;read&#x00A0;OK&#x003E;<br class="fancyvrb" /><a 
 id="x4-20026r13"></a>&#x00A0;&#x00A0;}</div>
<!--l. 806--><p class="noindent" ></div>
<!--l. 808--><p class="noindent" >For more information about detecting errors in AST functions, see &#x00A7;<a 
href="sun211se4.html#x5-5100015">4.15<!--tex4ht:ref: ss:errordetection --></a>. For details of how to validate
input data read by AST, see &#x00A7;<a 
href="sun211se15.html#x16-1470006">15.6<!--tex4ht:ref: ss:validatinginput --></a> and &#x00A7;<a 
href="sun211se17.html#x18-1760004">17.4<!--tex4ht:ref: ss:readingforeignfits --></a>.
<a 
 id="x4-20027r30"></a>
<h4 class="subsectionHead"><span class="titlemark">3.6    </span> <a 
 id="x4-210006"></a>&#x2026;Display AST Data</h4>
<!--l. 815--><p class="noindent" >If you have a pointer to any AST <a 
href="sun211ss464.html#x491-6830000">Object</a>, you can display the data stored in that Object in textual form
as follows:
<!--l. 818--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb7"> <a 
 id="x4-21002r1"></a>&#x00A0;&#x00A0;astShow(&#x00A0;wcsinfo&#x00A0;);</div>
<!--l. 822--><p class="noindent" ></div>
<!--l. 824--><p class="noindent" >Here, we have used a pointer to the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> which we read earlier (&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>). The result is written to the
program&#x2019;s standard output stream. This can be very useful during debugging.
<!--l. 828--><p class="noindent" >For more details about using <a 
href="sun211ss187.html#x212-4040000">astShow</a>, see &#x00A7;<a 
href="sun211se4.html#x5-380004">4.4<!--tex4ht:ref: ss:displayingobjects --></a>. For information about interpreting the output, also see
&#x00A7;<a 
href="sun211se15.html#x16-1490008">15.8<!--tex4ht:ref: ss:textualoutputformat --></a>.
<a 
 id="x4-21003r31"></a>
<h4 class="subsectionHead"><span class="titlemark">3.7    </span> <a 
 id="x4-220007"></a>&#x2026;Convert Between Pixel and World Coordinates</h4>
<!--l. 834--><p class="noindent" >You may use a pointer to a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, such as we read in &#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>, to transform a set of points between the
pixel coordinates of an image and the associated world coordinates. If you are working in two
dimensions, proceed as follows:
<!--l. 839--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb8"> <a 
 id="x4-22002r1"></a>&#x00A0;&#x00A0;double&#x00A0;xpixel[&#x00A0;N&#x00A0;],&#x00A0;ypixel[&#x00A0;N&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-22004r2"></a>&#x00A0;&#x00A0;double&#x00A0;xworld[&#x00A0;N&#x00A0;],&#x00A0;yworld[&#x00A0;N&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-22006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-22008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-22010r5"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-22012r6"></a>&#x00A0;&#x00A0;astTran2(&#x00A0;wcsinfo,&#x00A0;N,&#x00A0;xpixel,&#x00A0;ypixel,&#x00A0;1,&#x00A0;xworld,&#x00A0;yworld&#x00A0;);</div>
<!--l. 848--><p class="noindent" ></div>
<!--l. 850--><p class="noindent" >Here, N is the number of points to be transformed, &#x201C;xpixel&#x201D; and &#x201C;ypixel&#x201D; hold
the pixel coordinates, and &#x201C;xworld&#x201D; and &#x201C;yworld&#x201D; receive the returned world
coordinates.<span class="footnote-mark"><a 
href="#fn5x0" id="fn5x0-bk"><sup class="textsuperscript">5</sup></a></span><a 
 id="x4-22013f5"></a>
To transform in the opposite direction, interchange the two pairs of arrays (so that the world
coordinates are given as input) and change the fifth argument of <a 
href="sun211ss219.html#x244-4360000">astTran2</a> to zero.
<!--l. 861--><p class="noindent" >To transform points in one dimension, use <a 
href="sun211ss218.html#x243-4350000">astTran1</a>. In any other number of dimensions (or if the
number of dimensions is initially unknown), use <a 
href="sun211ss222.html#x247-4390000">astTranN</a> or <a 
href="sun211ss223.html#x248-4400000">astTranP</a>. These functions are described
in Appendix&#x00A0;<a 
href="sun211se24.html#x25-2170002">B<!--tex4ht:ref: ss:functiondescriptions --></a>.
                                                                                       

                                                                                       
<!--l. 866--><p class="noindent" >For more information about transforming coordinates, see &#x00A7;<a 
href="sun211se4.html#x5-420008">4.8<!--tex4ht:ref: ss:transforming --></a> and &#x00A7;<a 
href="sun211se13.html#x14-1280006">13.6<!--tex4ht:ref: ss:framesetasmapping --></a>. For details of how to handle
missing coordinates, see &#x00A7;<a 
href="sun211se5.html#x6-620009">5.9<!--tex4ht:ref: ss:badcoordinates --></a>.
<a 
 id="x4-22014r32"></a>
<h4 class="subsectionHead"><span class="titlemark">3.8    </span> <a 
 id="x4-230008"></a>&#x2026;Test if a WCS is a Celestial Coordinate System</h4>
<!--l. 873--><p class="noindent" >The world coordinate system (WCS) currently associated with an image may often be a celestial
coordinate system, but this need not necessarily be the case. For instance, instead of right ascension
and declination, an image might have a WCS with axes representing wavelength and slit position, or
maybe just plain old pixels.
<!--l. 879--><p class="noindent" >If you have obtained a WCS calibration for an image, as in &#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>, in the form of a pointer &#x201C;wcsinfo&#x201D; to a
<a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, then you may determine if the current coordinate system is a celestial one or not, as
follows:
<!--l. 884--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb9"> <a 
 id="x4-23002r1"></a>&#x00A0;&#x00A0;AstFrame&#x00A0;*frame;<br class="fancyvrb" /><a 
 id="x4-23004r2"></a>&#x00A0;&#x00A0;int&#x00A0;issky;<br class="fancyvrb" /><a 
 id="x4-23006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-23008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-23010r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-23012r6"></a>&#x00A0;&#x00A0;/*&#x00A0;Obtain&#x00A0;a&#x00A0;pointer&#x00A0;to&#x00A0;the&#x00A0;current&#x00A0;Frame&#x00A0;and&#x00A0;determine&#x00A0;if&#x00A0;it&#x00A0;is&#x00A0;a
<br class="fancyvrb" /><a 
 id="x4-23014r7"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;SkyFrame.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-23016r8"></a>&#x00A0;&#x00A0;frame&#x00A0;=&#x00A0;astGetFrame(&#x00A0;wcsinfo,&#x00A0;AST__CURRENT&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-23018r9"></a>&#x00A0;&#x00A0;issky&#x00A0;=&#x00A0;astIsASkyFrame(&#x00A0;frame&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-23020r10"></a>&#x00A0;&#x00A0;frame&#x00A0;=&#x00A0;astAnnul(&#x00A0;frame&#x00A0;);</div>
<!--l. 897--><p class="noindent" ></div>
<!--l. 899--><p class="noindent" >This will set &#x201C;issky&#x201D; to 1 if the WCS is a celestial coordinate system, and to zero otherwise.
<a 
 id="x4-23021r33"></a>
<h4 class="subsectionHead"><span class="titlemark">3.9    </span> <a 
 id="x4-240009"></a>&#x2026;Test if a WCS is a Spectral Coordinate System</h4>
<!--l. 903--><p class="noindent" >Testing for a spectral coordinate system is basically the same as testing for a celestial coordinate
system (see the previous section). The one difference is that you use the astIsASpecFrame function in
place of the astIsASkyFrame function.
<a 
 id="x4-24001r34"></a>
<h4 class="subsectionHead"><span class="titlemark">3.10    </span> <a 
 id="x4-2500010"></a>&#x2026;Format Coordinates for Display</h4>
<!--l. 912--><p class="noindent" >Once you have converted pixel coordinates into world coordinates (&#x00A7;<a 
href="#x4-220007">3.7<!--tex4ht:ref: ss:howtotransform --></a>), you may want to
format them as text before displaying them. Typically, this would convert from (say) radians
into something more comprehensible. Using the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> pointer &#x201C;wcsinfo&#x201D; obtained in
&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a> and a pair of world coordinates &#x201C;xw&#x201D; and &#x201C;yw&#x201D; (<em>e.g.</em>&#x00A0;see &#x00A7;<a 
href="#x4-220007">3.7<!--tex4ht:ref: ss:howtotransform --></a>), you could proceed as
follows:
<!--l. 920--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb10"> <a 
 id="x4-25002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;stdio.h&#x003E;<br class="fancyvrb" /><a 
 id="x4-25004r2"></a>&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*xtext,&#x00A0;*ytext;<br class="fancyvrb" /><a 
 id="x4-25006r3"></a>&#x00A0;&#x00A0;double&#x00A0;xw,&#x00A0;yw;<br class="fancyvrb" /><a 
 id="x4-25008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-25010r5"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-25012r6"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-25014r7"></a>&#x00A0;&#x00A0;xtext&#x00A0;=&#x00A0;astFormat(&#x00A0;wcsinfo,&#x00A0;1,&#x00A0;xw&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-25016r8"></a>&#x00A0;&#x00A0;ytext&#x00A0;=&#x00A0;astFormat(&#x00A0;wcsinfo,&#x00A0;2,&#x00A0;yw&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-25018r9"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-25020r10"></a>&#x00A0;&#x00A0;(void)&#x00A0;printf(&#x00A0;&#x0022;Position&#x00A0;=&#x00A0;%s,&#x00A0;%s&#x005C;n&#x0022;,&#x00A0;xtext,&#x00A0;ytext&#x00A0;);</div>
<!--l. 933--><p class="noindent" ></div>
<!--l. 935--><p class="noindent" >Here, the second argument to <a 
href="sun211ss56.html#x81-2730000">astFormat</a> is the axis number.
<!--l. 937--><p class="noindent" >With celestial coordinates, this will usually result in sexagesimal notation, such as &#x201C;12:34:56.7&#x201D;.
However, the same method may be applied to any type of coordinates and appropriate formatting
will be employed.
                                                                                       

                                                                                       
<!--l. 942--><p class="noindent" >For more information about formatting coordinate values and how to control the style of formatting
used, see &#x00A7;<a 
href="sun211se7.html#x8-790006">7.6<!--tex4ht:ref: ss:formattingaxisvalues --></a> and &#x00A7;<a 
href="sun211se8.html#x9-960006">8.6<!--tex4ht:ref: ss:formattingskyaxisvalues --></a>. If necessary, also see &#x00A7;<a 
href="sun211se7.html#x8-800007">7.7<!--tex4ht:ref: ss:normalising --></a> for details of how to &#x201C;normalise&#x201D; a set of
coordinates so that they lie within the standard range (<em>e.g.</em>&#x00A0;0 to 24 hours for right ascension and
<!--l. 948--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-bin">&#x00B1;</mo> <mn>9</mn><msup><mrow 
><mn>0</mn></mrow><mrow 
><mo 
class="MathClass-bin">&#x2218;</mo></mrow></msup 
></math> for
declination).
<a 
 id="x4-25021r35"></a>
<h4 class="subsectionHead"><span class="titlemark">3.11    </span> <a 
 id="x4-2600011"></a>&#x2026;Display Coordinates as they are Transformed</h4>
<!--l. 953--><p class="noindent" >In addition to formatting coordinates as part of a program&#x2019;s output, you may also want to examine
coordinate values while debugging your program. To save time, you can &#x201C;eavesdrop&#x201D; on the
coordinate values being processed every time they are transformed. For example, when using the
<a 
href="sun211ss453.html#x480-6720000">FrameSet</a> pointer &#x201C;wcsinfo&#x201D; obtained in &#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a> to transform coordinates (&#x00A7;<a 
href="#x4-220007">3.7<!--tex4ht:ref: ss:howtotransform --></a>), you could inspect the
coordinate values as follows:
<!--l. 962--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb11"> <a 
 id="x4-26002r1"></a>&#x00A0;&#x00A0;astSet(&#x00A0;wcsinfo,&#x00A0;&#x0022;Report=1&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-26004r2"></a>&#x00A0;&#x00A0;astTran2(&#x00A0;wcsinfo,&#x00A0;N,&#x00A0;xpixel,&#x00A0;ypixel,&#x00A0;1,&#x00A0;xworld,&#x00A0;yworld&#x00A0;);</div>
<!--l. 967--><p class="noindent" ></div>
<!--l. 969--><p class="noindent" >By setting the FrameSet&#x2019;s <a 
href="sun211ss381.html#x407-5990000">Report</a> attribute to 1, coordinate transformations are automatically
displayed on the program&#x2019;s standard output stream, appropriately formatted, for example:
<div class="fancyvrb" id="fancyvrb12"> <a 
 id="x4-26006r1"></a>&#x00A0;&#x00A0;(42.1087,&#x00A0;20.2717)&#x00A0;--&#x003E;&#x00A0;(2:06:03.0,&#x00A0;34:22:39)<br class="fancyvrb" /><a 
 id="x4-26008r2"></a>&#x00A0;&#x00A0;(43.0197,&#x00A0;21.1705)&#x00A0;--&#x003E;&#x00A0;(2:08:20.6,&#x00A0;35:31:24)
<br class="fancyvrb" /><a 
 id="x4-26010r3"></a>&#x00A0;&#x00A0;(43.9295,&#x00A0;22.0716)&#x00A0;--&#x003E;&#x00A0;(2:10:38.1,&#x00A0;36:40:09)<br class="fancyvrb" /><a 
 id="x4-26012r4"></a>&#x00A0;&#x00A0;(44.8382,&#x00A0;22.9753)&#x00A0;--&#x003E;&#x00A0;(2:12:55.6,&#x00A0;37:48:55)
<br class="fancyvrb" /><a 
 id="x4-26014r5"></a>&#x00A0;&#x00A0;(45.7459,&#x00A0;23.8814)&#x00A0;--&#x003E;&#x00A0;(2:15:13.1,&#x00A0;38:57:40)<br class="fancyvrb" /><a 
 id="x4-26016r6"></a>&#x00A0;&#x00A0;(46.6528,&#x00A0;24.7901)&#x00A0;--&#x003E;&#x00A0;(2:17:30.6,&#x00A0;40:06:25)
<br class="fancyvrb" /><a 
 id="x4-26018r7"></a>&#x00A0;&#x00A0;(47.5589,&#x00A0;25.7013)&#x00A0;--&#x003E;&#x00A0;(2:19:48.1,&#x00A0;41:15:11)<br class="fancyvrb" /><a 
 id="x4-26020r8"></a>&#x00A0;&#x00A0;(48.4644,&#x00A0;26.6149)&#x00A0;--&#x003E;&#x00A0;(2:22:05.6,&#x00A0;42:23:56)
<br class="fancyvrb" /><a 
 id="x4-26022r9"></a>&#x00A0;&#x00A0;(49.3695,&#x00A0;27.5311)&#x00A0;--&#x003E;&#x00A0;(2:24:23.1,&#x00A0;43:32:41)<br class="fancyvrb" /><a 
 id="x4-26024r10"></a>&#x00A0;&#x00A0;(50.2742,&#x00A0;28.4499)&#x00A0;--&#x003E;&#x00A0;(2:26:40.6,&#x00A0;44:41:27)</div>
<!--l. 986--><p class="noindent" >For a complete description of the Report attribute, see its entry in Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>. For further details of
how to set and enquire attribute values, see &#x00A7;<a 
href="sun211se4.html#x5-400006">4.6<!--tex4ht:ref: ss:settingattributes --></a> and &#x00A7;<a 
href="sun211se4.html#x5-390005">4.5<!--tex4ht:ref: ss:gettingattributes --></a>.
<a 
 id="x4-26025r36"></a>
<h4 class="subsectionHead"><span class="titlemark">3.12    </span> <a 
 id="x4-2700012"></a>&#x2026;Read Coordinates Entered by a User</h4>
<!--l. 993--><p class="noindent" >In addition to writing out coordinate values generated by your program (&#x00A7;<a 
href="#x4-2500010">3.10<!--tex4ht:ref: ss:howtoformatcoordinates --></a>), you may also need to
accept coordinates entered by a user, or perhaps read from a file. In this case, you will probably want
to allow &#x201C;free-format&#x201D; input, so that the user has some flexibility in the format that can be used. You
will probably also want to detect any typing errors.
<!--l. 1000--><p class="noindent" >Let&#x2019;s assume that you want to read a number of lines of text, each containing the world
coordinates of a single point, and to split each line into individual numerical coordinate
values. Using the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> pointer &#x201C;wcsinfo&#x201D; obtained earlier (&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>), you could proceed as
follows:
<!--l. 1006--><p class="noindent" ><div class="small">
                                                                                       

                                                                                       
<div class="fancyvrb" id="fancyvrb13"> <a 
 id="x4-27002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;stdio.h&#x003E;<br class="fancyvrb" /><a 
 id="x4-27004r2"></a>&#x00A0;&#x00A0;char&#x00A0;*t;<br class="fancyvrb" /><a 
 id="x4-27006r3"></a>&#x00A0;&#x00A0;char&#x00A0;text[&#x00A0;MAXCHARS&#x00A0;+&#x00A0;2&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-27008r4"></a>&#x00A0;&#x00A0;double&#x00A0;coord[&#x00A0;10&#x00A0;];
<br class="fancyvrb" /><a 
 id="x4-27010r5"></a>&#x00A0;&#x00A0;int&#x00A0;iaxis,&#x00A0;n,&#x00A0;naxes;<br class="fancyvrb" /><a 
 id="x4-27012r6"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27014r7"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-27016r8"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27018r9"></a>&#x00A0;&#x00A0;/*&#x00A0;Obtain&#x00A0;the&#x00A0;number&#x00A0;of&#x00A0;coordinate&#x00A0;axes&#x00A0;(if&#x00A0;not&#x00A0;already&#x00A0;known).&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-27020r10"></a>&#x00A0;&#x00A0;naxes&#x00A0;=&#x00A0;astGetI(&#x00A0;wcsinfo,&#x00A0;&#x0022;Naxes&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-27022r11"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27024r12"></a>&#x00A0;&#x00A0;/*&#x00A0;Loop&#x00A0;to&#x00A0;read&#x00A0;each&#x00A0;line&#x00A0;of&#x00A0;input&#x00A0;text,&#x00A0;in&#x00A0;this&#x00A0;case&#x00A0;from&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-27026r13"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;standard&#x00A0;input&#x00A0;stream&#x00A0;(your&#x00A0;programming&#x00A0;environment&#x00A0;will&#x00A0;probably
<br class="fancyvrb" /><a 
 id="x4-27028r14"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;provide&#x00A0;a&#x00A0;better&#x00A0;way&#x00A0;of&#x00A0;reading&#x00A0;text&#x00A0;than&#x00A0;this).&#x00A0;Set&#x00A0;the&#x00A0;pointer
<br class="fancyvrb" /><a 
 id="x4-27030r15"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x0022;t&#x0022;&#x00A0;to&#x00A0;the&#x00A0;start&#x00A0;of&#x00A0;each&#x00A0;line&#x00A0;read.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27032r16"></a>&#x00A0;&#x00A0;while&#x00A0;(&#x00A0;t&#x00A0;=&#x00A0;fgets(&#x00A0;text,&#x00A0;MAXCHARS&#x00A0;+&#x00A0;2,&#x00A0;stdin&#x00A0;)&#x00A0;)&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-27034r17"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-27036r18"></a>&#x00A0;&#x00A0;/*&#x00A0;Attempt&#x00A0;to&#x00A0;read&#x00A0;a&#x00A0;coordinate&#x00A0;for&#x00A0;each&#x00A0;axis.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27038r19"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(&#x00A0;iaxis&#x00A0;=&#x00A0;1;&#x00A0;iaxis&#x00A0;&#x003C;=&#x00A0;naxes;&#x00A0;iaxis++&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-27040r20"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;n&#x00A0;=&#x00A0;astUnformat(&#x00A0;wcsinfo,&#x00A0;iaxis,&#x00A0;t,&#x00A0;&#x0026;coord[&#x00A0;iaxis&#x00A0;-&#x00A0;1&#x00A0;]&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-27042r21"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27044r22"></a>&#x00A0;&#x00A0;/*&#x00A0;If&#x00A0;nothing&#x00A0;was&#x00A0;read&#x00A0;and&#x00A0;this&#x00A0;is&#x00A0;not&#x00A0;the&#x00A0;first&#x00A0;axis&#x00A0;or&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-27046r23"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;end-of-string,&#x00A0;try&#x00A0;stepping&#x00A0;over&#x00A0;a&#x00A0;separator&#x00A0;and&#x00A0;reading&#x00A0;again.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-27048r24"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!n&#x00A0;&#x0026;&#x0026;&#x00A0;(&#x00A0;iaxis&#x00A0;&#x003E;&#x00A0;1&#x00A0;)&#x00A0;&#x0026;&#x0026;&#x00A0;*t&#x00A0;)<br class="fancyvrb" /><a 
 id="x4-27050r25"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;n&#x00A0;=&#x00A0;astUnformat(&#x00A0;wcsinfo,&#x00A0;iaxis,&#x00A0;++t,&#x00A0;&#x0026;coord[&#x00A0;iaxis&#x00A0;-&#x00A0;1&#x00A0;]&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-27052r26"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27054r27"></a>&#x00A0;&#x00A0;/*&#x00A0;Quit&#x00A0;if&#x00A0;nothing&#x00A0;was&#x00A0;read,&#x00A0;otherwise&#x00A0;move&#x00A0;on&#x00A0;to&#x00A0;the&#x00A0;next&#x00A0;coordinate.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27056r28"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!n&#x00A0;)&#x00A0;break;
<br class="fancyvrb" /><a 
 id="x4-27058r29"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;t&#x00A0;+=&#x00A0;n;<br class="fancyvrb" /><a 
 id="x4-27060r30"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-27062r31"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27064r32"></a>&#x00A0;&#x00A0;/*&#x00A0;Test&#x00A0;for&#x00A0;the&#x00A0;possible&#x00A0;errors&#x00A0;that&#x00A0;may&#x00A0;occur...&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27066r33"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-27068r34"></a>&#x00A0;&#x00A0;/*&#x00A0;Error&#x00A0;detected&#x00A0;by&#x00A0;AST&#x00A0;(a&#x00A0;message&#x00A0;will&#x00A0;have&#x00A0;been&#x00A0;issued).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27070r35"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!astOK&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-27072r36"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;break;<br class="fancyvrb" /><a 
 id="x4-27074r37"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-27076r38"></a>&#x00A0;&#x00A0;/*&#x00A0;Error&#x00A0;in&#x00A0;input&#x00A0;data&#x00A0;at&#x00A0;character&#x00A0;t[n].&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-27078r39"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;if&#x00A0;(&#x00A0;*t&#x00A0;||&#x00A0;!n&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-27080r40"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;handle&#x00A0;the&#x00A0;error,&#x00A0;or&#x00A0;report&#x00A0;your&#x00A0;own&#x00A0;message&#x00A0;here&#x003E;<br class="fancyvrb" /><a 
 id="x4-27082r41"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;break;<br class="fancyvrb" /><a 
 id="x4-27084r42"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-27086r43"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-27088r44"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;coordinates&#x00A0;were&#x00A0;read&#x00A0;OK&#x003E;<br class="fancyvrb" /><a 
 id="x4-27090r45"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-27092r46"></a>&#x00A0;&#x00A0;}</div>
<!--l. 1055--><p class="noindent" ></div>
<!--l. 1057--><p class="noindent" >This algorithm has the advantage of accepting free-format input in whatever style is appropriate for
the world coordinates in use (under the control of the FrameSet whose pointer you provide).
For example, wavelength values might be read as floating point numbers (<em>e.g.</em>&#x00A0;&#x201C;1.047&#x201D; or
&#x201C;4787&#x201D;), whereas celestial positions could be given in sexagesimal format (<em>e.g.</em>&#x00A0;&#x201C;12:34:56&#x201D;
or &#x201C;12&#x00A0;34.5&#x201D;) and would be converted into radians. Individual coordinate values may
be separated by white space and/or any non-ambiguous separator character, such as a
comma.
<!--l. 1067--><p class="noindent" >For more information on reading coordinate values using the <a 
href="sun211ss228.html#x253-4450000">astUnformat</a> function, see &#x00A7;<a 
href="sun211se7.html#x8-810008">7.8<!--tex4ht:ref: ss:unformattingaxisvalues --></a>. For
details of how sexagesimal formats are handled, and the forms of input that may be used for celestial
coordinates, see &#x00A7;<a 
href="sun211se8.html#x9-970007">8.7<!--tex4ht:ref: ss:unformattingskyaxisvalues --></a>.
<a 
 id="x4-27093r37"></a>
<h4 class="subsectionHead"><span class="titlemark">3.13    </span> <a 
 id="x4-2800013"></a>&#x2026;Create a New WCS Calibration</h4>
<!--l. 1075--><p class="noindent" >This section describes how to add a WCS calibration to a data set which you are creating from scratch,
rather than modifying an existing data set.
<!--l. 1078--><p class="noindent" >In most common cases, the simplest way to create a new WCS calibration from scratch is probably to
create a set of strings describing the required calibration in terms of the keywords used by the FITS
WCS standard, and then convert these strings into an AST <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> describing the calibration.
This FrameSet can then be used for many other purposes, or simply stored in the data
set.
<!--l. 1085--><p class="noindent" >The full FITS-WCS standard is quite involved, currently running to four separate papers, but the basic kernel
is quite simple, involving the following keywords (all of which end with an integer axis index, indicated
below by <!--l. 1088--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo> <mi 
>i</mi> <mo 
class="MathClass-rel">&#x003E;</mo></math>):
     <dl class="description"><dt class="description">
CRPIX&#x003C;i&#x003E; </dt><dd 
class="description"><br 
class="newline" />hold the pixel coordinates at a reference point
                                                                                       

                                                                                       
     </dd><dt class="description">
CRVAL&#x003C;i&#x003E; </dt><dd 
class="description"><br 
class="newline" />hold the corresponding WCS coordinates at the reference point
     </dd><dt class="description">
CTYPE&#x003C;i&#x003E; </dt><dd 
class="description"><br 
class="newline" />name the quantity represented by the WCS axes, together with the projection algorithm
     used to convert the scaled and rotated pixel coordinates to WCS coordinates.
     </dd><dt class="description">
CD&#x003C;i&#x003E;_&#x003C;j&#x003E; </dt><dd 
class="description"><br 
class="newline" />a set of keywords which specify the elements of a matrix. This matrix scales pixel offsets
     from the reference point into the offsets required as input by the projection algorithm
     specified  by  the  CTYPE  keywords.  This  matrix  specifies  the  scale  and  rotation  of  the
     image.  If  there  is  no  rotation  the  off-diagonal  elements  of  the  matrix  (<em>e.g.</em>  CD1_2  and
     CD2_1) can be omitted.</dd></dl>
<!--l. 1108--><p class="noindent" >As an example consider the common case of a simple 2D image of the sky in which north is parallel to
the second pixel axis and east parallel to the (negative) first pixel axis. The image scale is 1.2
arc-seconds per pixel on both axes, and the image is presumed to have been obtained with a tangent
plane projection. Furthermore, it is known that pixel coordinates (100.5,98.4) correspond to
an RA of 11:00:10 and a Dec. of -23:26:02. A suitable set of FITS-WCS header cards could
be:
<!--l. 1116--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb14"> <a 
 id="x4-28002r1"></a>&#x00A0;&#x00A0;CTYPE1&#x00A0;&#x00A0;=&#x00A0;&#x2019;RA---TAN&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Axis&#x00A0;1&#x00A0;represents&#x00A0;RA&#x00A0;with&#x00A0;a&#x00A0;tan&#x00A0;projection<br class="fancyvrb" /><a 
 id="x4-28004r2"></a>&#x00A0;&#x00A0;CTYPE2&#x00A0;&#x00A0;=&#x00A0;&#x2019;DEC--TAN&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Axis&#x00A0;2&#x00A0;represents&#x00A0;Dec&#x00A0;with&#x00A0;a&#x00A0;tan&#x00A0;projection
<br class="fancyvrb" /><a 
 id="x4-28006r3"></a>&#x00A0;&#x00A0;CRPIX1&#x00A0;&#x00A0;=&#x00A0;100.5&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Pixel&#x00A0;coordinates&#x00A0;of&#x00A0;reference&#x00A0;point
<br class="fancyvrb" /><a 
 id="x4-28008r4"></a>&#x00A0;&#x00A0;CRPIX2&#x00A0;&#x00A0;=&#x00A0;98.4&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Pixel&#x00A0;coordinates&#x00A0;of&#x00A0;reference&#x00A0;point
<br class="fancyvrb" /><a 
 id="x4-28010r5"></a>&#x00A0;&#x00A0;CRVAL1&#x00A0;&#x00A0;=&#x00A0;165.04167&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Degrees&#x00A0;equivalent&#x00A0;of&#x00A0;&#x0022;11:00:10&#x0022;&#x00A0;hours
<br class="fancyvrb" /><a 
 id="x4-28012r6"></a>&#x00A0;&#x00A0;CRVAL2&#x00A0;&#x00A0;=&#x00A0;-23.433889&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Decimal&#x00A0;equivalent&#x00A0;of&#x00A0;&#x0022;-23:26:02&#x0022;&#x00A0;degrees
<br class="fancyvrb" /><a 
 id="x4-28014r7"></a>&#x00A0;&#x00A0;CD1_1&#x00A0;&#x00A0;&#x00A0;=&#x00A0;-0.0003333333&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Decimal&#x00A0;degrees&#x00A0;equivalent&#x00A0;of&#x00A0;-1.2&#x00A0;arc-seconds
<br class="fancyvrb" /><a 
 id="x4-28016r8"></a>&#x00A0;&#x00A0;CD2_2&#x00A0;&#x00A0;&#x00A0;=&#x00A0;0.0003333333&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Decimal&#x00A0;degrees&#x00A0;equivalent&#x00A0;of&#x00A0;1.2&#x00A0;arc-seconds</div>
<!--l. 1127--><p class="noindent" ></div>
<!--l. 1129--><p class="noindent" >Notes:
     <ul class="itemize1">
     <li class="itemize">a FITS header card begins with the keyword name starting at column 1, has an equals
     sign in column 9, and the keyword value in columns 11 to 80.
     </li>
     <li class="itemize">string values must be enclosed in single quotes.
     </li>
     <li class="itemize">celestial longitude and latitude must both be specified in decimal degrees.
     </li>
     <li class="itemize">the CD1_1 value is negative to indicate that RA increases as the first pixel axis decreases.
                                                                                       

                                                                                       
     </li>
     <li class="itemize">the (RA,Dec) coordinates will be taken as ICRS coordinates. For FK5 you should add:
     <!--l. 1140--><p class="noindent" ><div class="small">
     <div class="fancyvrb" id="fancyvrb15">  <a 
 id="x4-28018r1"></a>&#x00A0;&#x00A0;RADESYS&#x00A0;=&#x00A0;&#x2019;FK5&#x2019;<br class="fancyvrb" /><a 
 id="x4-28020r2"></a>&#x00A0;&#x00A0;EQUINOX&#x00A0;=&#x00A0;2005.6</div>
     <!--l. 1145--><p class="noindent" ></div>
     <!--l. 1147--><p class="noindent" >The EQUINOX value defaults to J2000.0 if omitted. FK4 can also be used in place of FK5, in
     which case EQUINOX defaults to B1950.0.
     </li></ul>
<!--l. 1152--><p class="noindent" >Once you have created these FITS-WCS header card strings, you should store them in a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> and
then read the corresponding FrameSet from the FitsChan. How to do this is described in
&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>.
<!--l. 1156--><p class="noindent" >Having created the WCS calibration, you may want to store it in a data file. How to do this is described in
&#x00A7;<a 
href="#x4-3000015">3.15<!--tex4ht:ref: ss:howtowritewcs --></a>).<span class="footnote-mark"><a 
href="#fn6x0" id="fn6x0-bk"><sup class="textsuperscript">6</sup></a></span><a 
 id="x4-28021f6"></a>
<!--l. 1161--><p class="noindent" >If the required WCS calibration cannot be described as a set of FITS-WCS headers, then a different
approach is necessary. In this case, you should first create a <a 
href="sun211ss452.html#x479-6710000">Frame</a> describing pixel coordinates,
and store this Frame in a new FrameSet. You should then create a new Frame describing
the world coordinate system. This Frame may be a specific subclass of Frame such as a
<a 
href="sun211ss478.html#x505-6970000">SkyFrame</a> for celestial coordinates, a <a 
href="sun211ss481.html#x508-7000000">SpecFrame</a> for spectral coordinates, a Timeframe for time
coordinates, or a <a 
href="sun211ss443.html#x470-6620000">CmpFrame</a> for a combination of different coordinates. You also need to
create a suitable <a 
href="sun211ss459.html#x486-6780000">Mapping</a> which transforms pixel coordinates into world coordinates. AST
provides many different types of Mappings, all of which can be combined together in
arbitrary fashions to create more complicated Mappings. The WCS Frame should then be
added into the FrameSet, using the Mapping to connect the WCS Frame with the pixel
Frame.
<a 
 id="x4-28022r38"></a>
<h4 class="subsectionHead"><span class="titlemark">3.14    </span> <a 
 id="x4-2900014"></a>&#x2026;Modify a WCS Calibration</h4>
<!--l. 1178--><p class="noindent" >The usual reason for wishing to modify the WCS calibration associated with a dataset is that the data
have been geometrically transformed in some way (here, we will assume a 2-dimensional image
dataset). This causes the image features (stars, galaxies, <em>etc.</em>) to move with respect to the grid of pixels
which they occupy, so that any coordinate systems previously associated with the image become
invalid.
<!--l. 1186--><p class="noindent" >To correct for this, it is necessary to set up a <a 
href="sun211ss459.html#x486-6780000">Mapping</a> which expresses the positions of image
features in the new data grid in terms of their positions in the old grid. In both cases, the grid
coordinates we use will have the first pixel centred at (1,1) with each pixel being a unit
square.
<!--l. 1192--><p class="noindent" >AST allows you to correct for any type of geometrical transformation in this way, so long as a suitable
Mapping to describe it can be constructed. For purposes of illustration, we will assume here that the
new image coordinates &#x201C;xnew&#x201D; and &#x201C;ynew&#x201D; can be expressed in terms of the old coordinates &#x201C;xold&#x201D;
and &#x201C;yold&#x201D; as follows:
<!--l. 1198--><p class="noindent" ><div class="small">
                                                                                       

                                                                                       
<div class="fancyvrb" id="fancyvrb16"> <a 
 id="x4-29002r1"></a>&#x00A0;&#x00A0;double&#x00A0;xnew,&#x00A0;xold,&#x00A0;ynew,&#x00A0;yold;<br class="fancyvrb" /><a 
 id="x4-29004r2"></a>&#x00A0;&#x00A0;double&#x00A0;m[&#x00A0;4&#x00A0;],&#x00A0;z[&#x00A0;2&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-29006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-29010r5"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-29012r6"></a>&#x00A0;&#x00A0;xnew&#x00A0;=&#x00A0;xold&#x00A0;*&#x00A0;m[&#x00A0;0&#x00A0;]&#x00A0;+&#x00A0;yold&#x00A0;*&#x00A0;m[&#x00A0;1&#x00A0;]&#x00A0;+&#x00A0;z[&#x00A0;0&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-29014r7"></a>&#x00A0;&#x00A0;ynew&#x00A0;=&#x00A0;xold&#x00A0;*&#x00A0;m[&#x00A0;2&#x00A0;]&#x00A0;+&#x00A0;yold&#x00A0;*&#x00A0;m[&#x00A0;3&#x00A0;]&#x00A0;+&#x00A0;z[&#x00A0;1&#x00A0;];</div>
<!--l. 1208--><p class="noindent" ></div>
<!--l. 1210--><p class="noindent" >where &#x201C;m&#x201D; is a 2<!--l. 1210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin">&#x00D7;</mo></math>2
transformation matrix and &#x201C;z&#x201D; represents a shift of origin. This is therefore a general linear
coordinate transformation which can represent displacement, rotation, magnification and
shear.
<!--l. 1215--><p class="noindent" >In AST, it can be represented by concatenating two Mappings. The first is a <a 
href="sun211ss461.html#x488-6800000">MatrixMap</a>, which
implements the matrix multiplication. The second is a <a 
href="sun211ss498.html#x525-7170000">WinMap</a>, which linearly transforms one
coordinate window on to another, but will be used here simply to implement the shift of origin
(alternatively, a <a 
href="sun211ss476.html#x503-6950000">ShiftMap</a> could have been used in place of a WinMap). These Mappings may be
constructed and concatenated as follows:
<!--l. 1222--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb17"> <a 
 id="x4-29016r1"></a>&#x00A0;&#x00A0;AstCmpMap&#x00A0;*newmap;<br class="fancyvrb" /><a 
 id="x4-29018r2"></a>&#x00A0;&#x00A0;AstMatrixMap&#x00A0;*matrixmap;<br class="fancyvrb" /><a 
 id="x4-29020r3"></a>&#x00A0;&#x00A0;AstWinMap&#x00A0;*winmap;<br class="fancyvrb" /><a 
 id="x4-29022r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29024r5"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-29026r6"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-29028r7"></a>&#x00A0;&#x00A0;/*&#x00A0;The&#x00A0;MatrixMap&#x00A0;may&#x00A0;be&#x00A0;constructed&#x00A0;directly&#x00A0;from&#x00A0;the&#x00A0;matrix&#x00A0;&#x0022;m&#x0022;.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-29030r8"></a>&#x00A0;&#x00A0;matrixmap&#x00A0;=&#x00A0;astMatrixMap(&#x00A0;2,&#x00A0;2,&#x00A0;0,&#x00A0;m,&#x00A0;&#x0022;&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-29032r9"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29034r10"></a>&#x00A0;&#x00A0;/*&#x00A0;For&#x00A0;the&#x00A0;WinMap,&#x00A0;we&#x00A0;set&#x00A0;up&#x00A0;the&#x00A0;coordinates&#x00A0;of&#x00A0;the&#x00A0;corners&#x00A0;of&#x00A0;a&#x00A0;unit
<br class="fancyvrb" /><a 
 id="x4-29036r11"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;square&#x00A0;(window)&#x00A0;and&#x00A0;then&#x00A0;the&#x00A0;same&#x00A0;square&#x00A0;shifted&#x00A0;by&#x00A0;the&#x00A0;required<br class="fancyvrb" /><a 
 id="x4-29038r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;amount.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-29040r13"></a>&#x00A0;&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-29042r14"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;double&#x00A0;ina[]&#x00A0;=&#x00A0;{&#x00A0;0.0,&#x00A0;0.0&#x00A0;};<br class="fancyvrb" /><a 
 id="x4-29044r15"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;double&#x00A0;inb[]&#x00A0;=&#x00A0;{&#x00A0;1.0,&#x00A0;1.0&#x00A0;};
<br class="fancyvrb" /><a 
 id="x4-29046r16"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;double&#x00A0;outa[]&#x00A0;=&#x00A0;{&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;z[&#x00A0;0&#x00A0;],&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;z[&#x00A0;1&#x00A0;]&#x00A0;};<br class="fancyvrb" /><a 
 id="x4-29048r17"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;double&#x00A0;outb[]&#x00A0;=&#x00A0;{&#x00A0;1.0&#x00A0;+&#x00A0;z[&#x00A0;0&#x00A0;],&#x00A0;1.0&#x00A0;+&#x00A0;z[&#x00A0;1&#x00A0;]&#x00A0;};<br class="fancyvrb" /><a 
 id="x4-29050r18"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-29052r19"></a>&#x00A0;&#x00A0;/*&#x00A0;The&#x00A0;WinMap&#x00A0;will&#x00A0;then&#x00A0;implement&#x00A0;this&#x00A0;shift.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-29054r20"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;winmap&#x00A0;=&#x00A0;astWinMap(&#x00A0;2,&#x00A0;ina,&#x00A0;inb,&#x00A0;outa,&#x00A0;outb,&#x00A0;&#x0022;&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-29056r21"></a>&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-29058r22"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29060r23"></a>&#x00A0;&#x00A0;/*&#x00A0;Join&#x00A0;the&#x00A0;two&#x00A0;Mappings&#x00A0;together,&#x00A0;so&#x00A0;that&#x00A0;they&#x00A0;are&#x00A0;applied&#x00A0;one&#x00A0;after
<br class="fancyvrb" /><a 
 id="x4-29062r24"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;the&#x00A0;other.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-29064r25"></a>&#x00A0;&#x00A0;newmap&#x00A0;=&#x00A0;astCmpMap(&#x00A0;matrixmap,&#x00A0;winmap,&#x00A0;1,&#x00A0;&#x0022;&#x0022;&#x00A0;);</div>
<!--l. 1250--><p class="noindent" ></div>
<!--l. 1252--><p class="noindent" >You might, of course, create any other form of Mapping depending on the type of geometrical
transformation involved. For an overview of the Mappings provided by AST, see &#x00A7;<a 
href="sun211se2.html#x3-90002">2.2<!--tex4ht:ref: ss:mappingselection --></a>, and for
a description of the capabilities of each class of Mapping, see its entry in Appendix&#x00A0;<a 
href="sun211se26.html#x465-6570004">D<!--tex4ht:ref: ss:classdescriptions --></a>.
For an overview of how individual Mappings may be combined, see &#x00A7;<a 
href="sun211se2.html#x3-100003">2.3<!--tex4ht:ref: ss:cmpmapoverview --></a> (&#x00A7;<a 
href="sun211se6.html#x7-650006">6<!--tex4ht:ref: ss:cmpmaps --></a> gives more
details).
<!--l. 1260--><p class="noindent" >Assuming you have obtained a WCS calibration for your original image in the form of a pointer to a
<a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, &#x201C;wcsinfo1&#x201D; (&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>), the Mapping created above may be used to produce a calibration for the
new image as follows:
<!--l. 1265--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb18"> <a 
 id="x4-29066r1"></a>&#x00A0;&#x00A0;AstFrameSet&#x00A0;*wcsinfo1,&#x00A0;*wcsinfo2;<br class="fancyvrb" /><a 
 id="x4-29068r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29070r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-29072r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-29074r5"></a>&#x00A0;&#x00A0;/*&#x00A0;If&#x00A0;necessary,&#x00A0;make&#x00A0;a&#x00A0;copy&#x00A0;of&#x00A0;the&#x00A0;WCS&#x00A0;calibration,&#x00A0;since&#x00A0;we&#x00A0;are
<br class="fancyvrb" /><a 
 id="x4-29076r6"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;about&#x00A0;to&#x00A0;alter&#x00A0;it.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-29078r7"></a>&#x00A0;&#x00A0;wcsinfo2&#x00A0;=&#x00A0;astCopy(&#x00A0;wcsinfo1&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-29080r8"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-29082r9"></a>&#x00A0;&#x00A0;/*&#x00A0;Re-map&#x00A0;the&#x00A0;base&#x00A0;Frame&#x00A0;so&#x00A0;that&#x00A0;it&#x00A0;refers&#x00A0;to&#x00A0;the&#x00A0;new&#x00A0;data&#x00A0;grid<br class="fancyvrb" /><a 
 id="x4-29084r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;instead&#x00A0;of&#x00A0;the&#x00A0;old&#x00A0;one.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-29086r11"></a>&#x00A0;&#x00A0;astRemapFrame(&#x00A0;wcsinfo2,&#x00A0;AST__BASE,&#x00A0;newmap&#x00A0;);</div>
<!--l. 1279--><p class="noindent" ></div>
<!--l. 1281--><p class="noindent" >This will produce a pointer, &#x201C;wcsinfo2&#x201D;, to a new FrameSet in which all the coordinate systems
associated with your original image are modified so that they are correctly registered with the new
image instead.
                                                                                       

                                                                                       
<!--l. 1286--><p class="noindent" >For more information about re-mapping the Frames within a FrameSet, see &#x00A7;<a 
href="sun211se14.html#x15-1370004">14.4<!--tex4ht:ref: ss:remapframe --></a>. Also see &#x00A7;<a 
href="sun211se14.html#x15-1380005">14.5<!--tex4ht:ref: ss:wcsprocessingexample --></a> for a
similar example to the above, applicable to the case of reducing the size of an image by
binning.
<a 
 id="x4-29087r39"></a>
<h4 class="subsectionHead"><span class="titlemark">3.15    </span> <a 
 id="x4-3000015"></a>&#x2026;Write a Modified WCS Calibration to a Dataset</h4>
<!--l. 1293--><p class="noindent" >If you have modified the WCS calibration associated with a dataset, such as in the example
above (&#x00A7;<a 
href="#x4-2900014">3.14<!--tex4ht:ref: ss:howtomodifywcs --></a>), then you will need to write the modified version out along with any new
data.
<!--l. 1297--><p class="noindent" >In the same way as when reading a WCS calibration (&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>), how you do this will depend on your data
system, but we will assume that you wish to generate a set of FITS header cards that can be stored
with the data. You should usually make preparations for doing this when you first read
the WCS calibration from your input dataset by modifying the example given in &#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a> as
follows:
<!--l. 1305--><p class="noindent" ><div class="small">
<div class="fancyvrb" id="fancyvrb19"> <a 
 id="x4-30002r1"></a>&#x00A0;&#x00A0;AstFitsChan&#x00A0;*fitschan1;<br class="fancyvrb" /><a 
 id="x4-30004r2"></a>&#x00A0;&#x00A0;AstFrameSet&#x00A0;*wcsinfo1;<br class="fancyvrb" /><a 
 id="x4-30006r3"></a>&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*encode;<br class="fancyvrb" /><a 
 id="x4-30008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30010r5"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-30012r6"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-30014r7"></a>&#x00A0;&#x00A0;/*&#x00A0;Create&#x00A0;an&#x00A0;input&#x00A0;FitsChan&#x00A0;and&#x00A0;fill&#x00A0;it&#x00A0;with&#x00A0;FITS&#x00A0;header&#x00A0;cards.&#x00A0;Note,
<br class="fancyvrb" /><a 
 id="x4-30016r8"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;you&#x00A0;have&#x00A0;all&#x00A0;the&#x00A0;header&#x00A0;cards&#x00A0;in&#x00A0;a&#x00A0;single&#x00A0;string,&#x00A0;use&#x00A0;astPutCards&#x00A0;in
<br class="fancyvrb" /><a 
 id="x4-30018r9"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;place&#x00A0;of&#x00A0;astPutFits.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-30020r10"></a>&#x00A0;&#x00A0;fitschan1&#x00A0;=&#x00A0;astFitsChan(&#x00A0;NULL,&#x00A0;NULL,&#x00A0;&#x0022;&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-30022r11"></a>&#x00A0;&#x00A0;for&#x00A0;(&#x00A0;icard&#x00A0;=&#x00A0;0;&#x00A0;icard&#x00A0;&#x003C;&#x00A0;ncard;&#x00A0;icard++&#x00A0;)&#x00A0;astPutFits(&#x00A0;fitschan1,&#x00A0;cards[&#x00A0;icard&#x00A0;],&#x00A0;0&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-30024r12"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-30026r13"></a>&#x00A0;&#x00A0;/*&#x00A0;Note&#x00A0;which&#x00A0;encoding&#x00A0;has&#x00A0;been&#x00A0;used&#x00A0;for&#x00A0;the&#x00A0;WCS&#x00A0;information.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-30028r14"></a>&#x00A0;&#x00A0;encode&#x00A0;=&#x00A0;astGetC(&#x00A0;fitschan1,&#x00A0;&#x0022;Encoding&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-30030r15"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30032r16"></a>&#x00A0;&#x00A0;/*&#x00A0;Rewind&#x00A0;the&#x00A0;input&#x00A0;FitsChan&#x00A0;and&#x00A0;read&#x00A0;the&#x00A0;WCS&#x00A0;information&#x00A0;from&#x00A0;it.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-30034r17"></a>&#x00A0;&#x00A0;astClear(&#x00A0;fitschan1,&#x00A0;&#x0022;Card&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-30036r18"></a>&#x00A0;&#x00A0;wcsinfo1&#x00A0;=&#x00A0;astRead(&#x00A0;fitschan1&#x00A0;);</div>
<!--l. 1326--><p class="noindent" ></div>
<!--l. 1328--><p class="noindent" >Note how we have added an enquiry to determine how the WCS information is encoded in the input
FITS cards, storing a pointer to the resulting string in the &#x201C;encode&#x201D; variable. This must be done <b>before</b>
actually reading the WCS calibration.
<!--l. 1337--><p class="noindent" ><em>(<b>N.B.</b>&#x00A0;If you will be making extensive use of astGetC in your program, then you should allocate a
buffer and make a copy of this string, because the pointer returned by astGetC will only remain
valid for 50 invocations of the function, and you will need to use the <a 
href="sun211ss284.html#x310-5020000">Encoding</a> value again later
on.)</em>
<!--l. 1339--><p class="noindent" >Once you have produced a modified WCS calibration for the output dataset (<em>e.g.</em>&#x00A0;&#x00A7;<a 
href="#x4-2900014">3.14<!--tex4ht:ref: ss:howtomodifywcs --></a>), in the form of
a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> identified by the pointer &#x201C;wcsinfo2&#x201D;, you can produce a new <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> containing the
output FITS header cards as follows:
<div class="fancyvrb" id="fancyvrb20"> <a 
 id="x4-30038r1"></a>&#x00A0;&#x00A0;AstFitsChan&#x00A0;*fitschan2;<br class="fancyvrb" /><a 
 id="x4-30040r2"></a>&#x00A0;&#x00A0;AstFrameSet&#x00A0;*wcsinfo2;<br class="fancyvrb" /><a 
 id="x4-30042r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30044r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-30046r5"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-30048r6"></a>&#x00A0;&#x00A0;/*&#x00A0;Make&#x00A0;a&#x00A0;copy&#x00A0;of&#x00A0;the&#x00A0;input&#x00A0;FitsChan,&#x00A0;AFTER&#x00A0;the&#x00A0;WCS&#x00A0;information&#x00A0;has
<br class="fancyvrb" /><a 
 id="x4-30050r7"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;been&#x00A0;read&#x00A0;from&#x00A0;it.&#x00A0;This&#x00A0;will&#x00A0;propagate&#x00A0;all&#x00A0;the&#x00A0;input&#x00A0;FITS&#x00A0;header
<br class="fancyvrb" /><a 
 id="x4-30052r8"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cards,&#x00A0;apart&#x00A0;from&#x00A0;those&#x00A0;describing&#x00A0;the&#x00A0;input&#x00A0;WCS&#x00A0;calibration.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-30054r9"></a>&#x00A0;&#x00A0;fitschan2&#x00A0;=&#x00A0;astCopy(&#x00A0;fitschan1&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-30056r10"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30058r11"></a>&#x00A0;&#x00A0;/*&#x00A0;If&#x00A0;necessary,&#x00A0;make&#x00A0;modifications&#x00A0;to&#x00A0;the&#x00A0;cards&#x00A0;in&#x00A0;&#x0022;fitschan2&#x0022;
<br class="fancyvrb" /><a 
 id="x4-30060r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(e.g.&#x00A0;you&#x00A0;might&#x00A0;need&#x00A0;to&#x00A0;change&#x00A0;NAXIS1,&#x00A0;NAXIS2,&#x00A0;etc.,&#x00A0;to&#x00A0;account&#x00A0;for
<br class="fancyvrb" /><a 
 id="x4-30062r13"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;a&#x00A0;change&#x00A0;in&#x00A0;image&#x00A0;size).&#x00A0;You&#x00A0;probably&#x00A0;only&#x00A0;need&#x00A0;to&#x00A0;do&#x00A0;this&#x00A0;if&#x00A0;your
                                                                                       

                                                                                       
<br class="fancyvrb" /><a 
 id="x4-30064r14"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;data&#x00A0;system&#x00A0;does&#x00A0;not&#x00A0;provide&#x00A0;these&#x00A0;facilities&#x00A0;itself.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-30066r15"></a>&#x00A0;&#x00A0;&#x003C;details&#x00A0;not&#x00A0;shown&#x00A0;-&#x00A0;see&#x00A0;below&#x003E;
<br class="fancyvrb" /><a 
 id="x4-30068r16"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30070r17"></a>&#x00A0;&#x00A0;/*&#x00A0;Alternatively,&#x00A0;if&#x00A0;your&#x00A0;data&#x00A0;system&#x00A0;handles&#x00A0;the&#x00A0;propagation&#x00A0;of&#x00A0;FITS
<br class="fancyvrb" /><a 
 id="x4-30072r18"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;header&#x00A0;cards&#x00A0;to&#x00A0;the&#x00A0;output&#x00A0;dataset&#x00A0;for&#x00A0;you,&#x00A0;then&#x00A0;simply&#x00A0;create&#x00A0;an
<br class="fancyvrb" /><a 
 id="x4-30074r19"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;empty&#x00A0;FitsChan&#x00A0;to&#x00A0;contain&#x00A0;the&#x00A0;output&#x00A0;WCS&#x00A0;information&#x00A0;alone.<br class="fancyvrb" /><a 
 id="x4-30076r20"></a>&#x00A0;&#x00A0;fitschan2&#x00A0;=&#x00A0;astFitsChan(&#x00A0;NULL,&#x00A0;NULL,&#x00A0;&#x0022;&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-30078r21"></a>&#x00A0;&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-30080r22"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30082r23"></a>&#x00A0;&#x00A0;/*&#x00A0;Rewind&#x00A0;the&#x00A0;new&#x00A0;FitsChan&#x00A0;(if&#x00A0;necessary)&#x00A0;and&#x00A0;attempt&#x00A0;to&#x00A0;write&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-30084r24"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;output&#x00A0;WCS&#x00A0;information&#x00A0;to&#x00A0;it&#x00A0;using&#x00A0;the&#x00A0;same&#x00A0;encoding&#x00A0;method&#x00A0;as&#x00A0;the<br class="fancyvrb" /><a 
 id="x4-30086r25"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;input&#x00A0;dataset.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-30088r26"></a>&#x00A0;&#x00A0;astSet(&#x00A0;fitschan2,&#x00A0;&#x0022;Card=1,&#x00A0;Encoding=%s&#x0022;,&#x00A0;encode&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-30090r27"></a>&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!astWrite(&#x00A0;fitschan2,&#x00A0;wcsinfo2&#x00A0;)&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-30092r28"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30094r29"></a>&#x00A0;&#x00A0;/*&#x00A0;If&#x00A0;this&#x00A0;didn&#x2019;t&#x00A0;work&#x00A0;(the&#x00A0;WCS&#x00A0;FrameSet&#x00A0;has&#x00A0;become&#x00A0;too&#x00A0;complex),&#x00A0;then
<br class="fancyvrb" /><a 
 id="x4-30096r30"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;use&#x00A0;the&#x00A0;native&#x00A0;AST&#x00A0;encoding&#x00A0;instead.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-30098r31"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astSet(&#x00A0;fitschan2,&#x00A0;&#x0022;Encoding=NATIVE&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-30100r32"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(void)&#x00A0;astWrite(&#x00A0;fitschan2,&#x00A0;wcsinfo2&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-30102r33"></a>&#x00A0;&#x00A0;}</div>
<!--l. 1382--><p class="noindent" >For details of how to modify the contents of the output FitsChan in other ways, such as by adding,
over-writing or deleting header cards, see &#x00A7;<a 
href="sun211se16.html#x17-1610004">16.4<!--tex4ht:ref: ss:addressingfitscards --></a>, &#x00A7;<a 
href="sun211se16.html#x17-1660009">16.9<!--tex4ht:ref: ss:addingmulticards --></a>, &#x00A7;<a 
href="sun211se16.html#x17-1650008">16.8<!--tex4ht:ref: ss:addingfitscards --></a> and &#x00A7;<a 
href="sun211se16.html#x17-17000013">16.13<!--tex4ht:ref: ss:findingandchangingfits --></a>.
<!--l. 1387--><p class="noindent" >Once you have assembled the output FITS cards, you may retrieve them from the FitsChan that
contains them as follows:
<div class="fancyvrb" id="fancyvrb21"> <a 
 id="x4-30104r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;stdio.h&#x003E;<br class="fancyvrb" /><a 
 id="x4-30106r2"></a>&#x00A0;&#x00A0;char&#x00A0;card[&#x00A0;81&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-30108r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30110r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-30112r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-30114r6"></a>&#x00A0;&#x00A0;astClear(&#x00A0;fitschan2,&#x00A0;&#x0022;Card&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-30116r7"></a>&#x00A0;&#x00A0;while&#x00A0;(&#x00A0;astFindFits(&#x00A0;fitschan2,&#x00A0;&#x0022;%f&#x0022;,&#x00A0;card,&#x00A0;1&#x00A0;)&#x00A0;)&#x00A0;(void)&#x00A0;printf(&#x00A0;&#x0022;%s&#x005C;n&#x0022;,&#x00A0;card&#x00A0;);</div>
<!--l. 1402--><p class="noindent" >Here, we have simply written each card to the standard output stream, but you would obviously
replace this with a function invocation to store the cards in your output dataset.
<!--l. 1406--><p class="noindent" >For data systems that do not use FITS header cards, a different approach may be needed, possibly
involving use of a <a 
href="sun211ss441.html#x468-6600000">Channel</a> or <a 
href="sun211ss499.html#x526-7180000">XmlChan</a> (&#x00A7;<a 
href="sun211se15.html#x16-14100015">15<!--tex4ht:ref: ss:channels --></a>) rather than a FitsChan. In the case of the Starlink NDF
data format, for example, all of the above may be replaced by a single call to the function
<a 
href="http://www.starlink.ac.uk/cgi-bin/htxserver/sun33.htx/sun33.html?xref_ndfPtwcs" >ndfPtwcs</a>&#x2014;see <a 
href="http://www.starlink.ac.uk/cgi-bin/htxserver/sun33.htx/sun33.html?xref_" >SUN/33</a>. The whole process can probably be encapsulated in a similar way for most
data systems, whether they use FITS header cards or not.
<!--l. 1415--><p class="noindent" >For an overview of how to propagate WCS information through data processing steps, see &#x00A7;<a 
href="sun211se17.html#x18-1780006">17.6<!--tex4ht:ref: ss:propagatingwcsinformation --></a>. For
more information about writing WCS information to FitsChans, see &#x00A7;<a 
href="sun211se16.html#x17-1620005">16.5<!--tex4ht:ref: ss:writingnativefits --></a> and &#x00A7;<a 
href="sun211se17.html#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>. For
information about the options for encoding WCS information in FITS header cards, see
&#x00A7;<a 
href="sun211se16.html#x17-1580001">16.1<!--tex4ht:ref: ss:nativeencoding --></a>, &#x00A7;<a 
href="sun211se17.html#x18-1730001">17.1<!--tex4ht:ref: ss:foreignencodings --></a>, and the description of the Encoding attribute in Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>. For a complete
understanding of FitsChans and their use with FITS header cards, you should read &#x00A7;<a 
href="sun211se16.html#x17-15700016">16<!--tex4ht:ref: ss:nativefits --></a> and
&#x00A7;<a 
href="sun211se17.html#x18-17200017">17<!--tex4ht:ref: ss:foreignfits --></a>.
<a 
 id="x4-30117r40"></a>
<h4 class="subsectionHead"><span class="titlemark">3.16    </span> <a 
 id="x4-3100016"></a>&#x2026;Display a Graphical Coordinate Grid</h4>
<!--l. 1428--><p class="noindent" >A common requirement when displaying image data is to plot an associated coordinate grid
(<em>e.g.</em>&#x00A0;Figure&#x00A0;<a 
href="#x4-310019">9<!--tex4ht:ref: fig:overgrid --></a>) over the displayed image. <hr class="figure"><div class="figure" 
>
                                                                                       

                                                                                       
<a 
 id="x4-310019"></a>
                                                                                       

                                                                                       
<div class="center">
<img 
src="sun211_figures/overgrid_bw.png" alt="pdfpict"  
 width="70%" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9: </span><span  
class="content">An example of a displayed image with a coordinate grid plotted over it.</span></div><!--tex4ht:label?: x4-310019 -->
</div>
                                                                                       

                                                                                       
<!--l. 1439--><p class="noindent" ></div><hr class="endfigure">
<!--l. 1441--><p class="noindent" >The use of AST in such circumstances is independent of the underlying graphics system, so
starting up the graphics system, setting up a coordinate system, displaying the image, and
closing down afterwards can all be done using the graphics functions you would normally
use.
<!--l. 1446--><p class="noindent" >However, displaying an image at a precise location can be a little fiddly with some
graphics systems, and obviously the grid drawn by AST will not be accurately registered
with the image unless this is done correctly. In the following template, we therefore
illustrate both steps, basing the image display on the C interface to the PGPLOT graphics
package.<span class="footnote-mark"><a 
href="#fn7x0" id="fn7x0-bk"><sup class="textsuperscript">7</sup></a></span><a 
 id="x4-31002f7"></a>
Plotting a coordinate grid with AST then becomes a relatively minor part of what is almost a complete
graphics program.
<!--l. 1457--><p class="noindent" >Once again, we assume that a pointer, &#x201C;wcsinfo&#x201D;, to a suitable <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> associated with the image has
already been obtained (&#x00A7;<a 
href="#x4-190004">3.4<!--tex4ht:ref: ss:howtoreadwcs --></a>).
<div class="fancyvrb" id="fancyvrb22"> <a 
 id="x4-31004r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x0022;cpgplot.h&#x0022;<br class="fancyvrb" /><a 
 id="x4-31006r2"></a>&#x00A0;&#x00A0;AstPlot&#x00A0;*plot;<br class="fancyvrb" /><a 
 id="x4-31008r3"></a>&#x00A0;&#x00A0;const&#x00A0;float&#x00A0;*data;
<br class="fancyvrb" /><a 
 id="x4-31010r4"></a>&#x00A0;&#x00A0;float&#x00A0;hi,&#x00A0;lo,&#x00A0;scale,&#x00A0;x1,&#x00A0;x2,&#x00A0;xleft,&#x00A0;xright,&#x00A0;xscale;<br class="fancyvrb" /><a 
 id="x4-31012r5"></a>&#x00A0;&#x00A0;float&#x00A0;y1,&#x00A0;y2,&#x00A0;ybottom,&#x00A0;yscale,&#x00A0;ytop;
<br class="fancyvrb" /><a 
 id="x4-31014r6"></a>&#x00A0;&#x00A0;int&#x00A0;nx,&#x00A0;ny;<br class="fancyvrb" /><a 
 id="x4-31016r7"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31018r8"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x4-31020r9"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31022r10"></a>&#x00A0;&#x00A0;/*&#x00A0;Access&#x00A0;the&#x00A0;image&#x00A0;data,&#x00A0;which&#x00A0;we&#x00A0;assume&#x00A0;has&#x00A0;dimension&#x00A0;sizes&#x00A0;&#x0022;nx&#x0022;&#x00A0;and
<br class="fancyvrb" /><a 
 id="x4-31024r11"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x0022;ny&#x0022;,&#x00A0;and&#x00A0;will&#x00A0;be&#x00A0;accessed&#x00A0;via&#x00A0;the&#x00A0;&#x0022;data&#x0022;&#x00A0;pointer.&#x00A0;&#x00A0;Also&#x00A0;derive
<br class="fancyvrb" /><a 
 id="x4-31026r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;limits&#x00A0;for&#x00A0;scaling&#x00A0;it,&#x00A0;which&#x00A0;we&#x00A0;assign&#x00A0;to&#x00A0;the&#x00A0;variables&#x00A0;&#x0022;hi&#x0022;&#x00A0;and
<br class="fancyvrb" /><a 
 id="x4-31028r13"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x0022;lo&#x0022;.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31030r14"></a>&#x00A0;&#x00A0;&#x003C;this&#x00A0;stage&#x00A0;depends&#x00A0;on&#x00A0;your&#x00A0;data&#x00A0;system,&#x00A0;so&#x00A0;is&#x00A0;not&#x00A0;shown&#x003E;<br class="fancyvrb" /><a 
 id="x4-31032r15"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-31034r16"></a>&#x00A0;&#x00A0;/*&#x00A0;Open&#x00A0;PGPLOT&#x00A0;using&#x00A0;the&#x00A0;device&#x00A0;given&#x00A0;by&#x00A0;environment&#x00A0;variable<br class="fancyvrb" /><a 
 id="x4-31036r17"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PGPLOT_DEV&#x00A0;and&#x00A0;check&#x00A0;for&#x00A0;success.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31038r18"></a>&#x00A0;&#x00A0;if(&#x00A0;cpgbeg(&#x00A0;0,&#x00A0;&#x0022;&#x00A0;&#x0022;,&#x00A0;1,&#x00A0;1&#x00A0;)&#x00A0;==&#x00A0;1&#x00A0;)&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-31040r19"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31042r20"></a>&#x00A0;&#x00A0;/*&#x00A0;Clear&#x00A0;the&#x00A0;screen&#x00A0;and&#x00A0;ensure&#x00A0;equal&#x00A0;scales&#x00A0;on&#x00A0;both&#x00A0;axes.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31044r21"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpgpage();<br class="fancyvrb" /><a 
 id="x4-31046r22"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpgwnad(&#x00A0;0.0f,&#x00A0;1.0f,&#x00A0;0.0f,&#x00A0;1.0f&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31048r23"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-31050r24"></a>&#x00A0;&#x00A0;/*&#x00A0;Obtain&#x00A0;the&#x00A0;extent&#x00A0;of&#x00A0;the&#x00A0;plotting&#x00A0;area&#x00A0;(not&#x00A0;strictly&#x00A0;necessary&#x00A0;for
<br class="fancyvrb" /><a 
 id="x4-31052r25"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PGPLOT,&#x00A0;but&#x00A0;possibly&#x00A0;for&#x00A0;other&#x00A0;graphics&#x00A0;systems).&#x00A0;From&#x00A0;this,&#x00A0;derive
<br class="fancyvrb" /><a 
 id="x4-31054r26"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;the&#x00A0;display&#x00A0;scale&#x00A0;in&#x00A0;graphics&#x00A0;units&#x00A0;per&#x00A0;pixel&#x00A0;so&#x00A0;that&#x00A0;the&#x00A0;image
<br class="fancyvrb" /><a 
 id="x4-31056r27"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;will&#x00A0;fit&#x00A0;within&#x00A0;the&#x00A0;display&#x00A0;area.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31058r28"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpgqwin(&#x00A0;&#x0026;x1,&#x00A0;&#x0026;x2,&#x00A0;&#x0026;y1,&#x00A0;&#x0026;y2&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31060r29"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;xscale&#x00A0;=&#x00A0;(&#x00A0;x2&#x00A0;-&#x00A0;x1&#x00A0;)&#x00A0;/&#x00A0;nx;
<br class="fancyvrb" /><a 
 id="x4-31062r30"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;yscale&#x00A0;=&#x00A0;(&#x00A0;y2&#x00A0;-&#x00A0;y1&#x00A0;)&#x00A0;/&#x00A0;ny;<br class="fancyvrb" /><a 
 id="x4-31064r31"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;scale&#x00A0;=&#x00A0;(&#x00A0;xscale&#x00A0;&#x003C;&#x00A0;yscale&#x00A0;)&#x00A0;?&#x00A0;xscale&#x00A0;:&#x00A0;yscale;
<br class="fancyvrb" /><a 
 id="x4-31066r32"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31068r33"></a>&#x00A0;&#x00A0;/*&#x00A0;Calculate&#x00A0;the&#x00A0;extent&#x00A0;of&#x00A0;the&#x00A0;area&#x00A0;in&#x00A0;graphics&#x00A0;units&#x00A0;that&#x00A0;the&#x00A0;image
<br class="fancyvrb" /><a 
 id="x4-31070r34"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;will&#x00A0;occupy,&#x00A0;so&#x00A0;as&#x00A0;to&#x00A0;centre&#x00A0;it&#x00A0;within&#x00A0;the&#x00A0;display&#x00A0;area.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31072r35"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;xleft&#x00A0;&#x00A0;&#x00A0;=&#x00A0;0.5f&#x00A0;*&#x00A0;(&#x00A0;x1&#x00A0;+&#x00A0;x2&#x00A0;-&#x00A0;nx&#x00A0;*&#x00A0;scale&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31074r36"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;xright&#x00A0;&#x00A0;=&#x00A0;0.5f&#x00A0;*&#x00A0;(&#x00A0;x1&#x00A0;+&#x00A0;x2&#x00A0;+&#x00A0;nx&#x00A0;*&#x00A0;scale&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-31076r37"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;ybottom&#x00A0;=&#x00A0;0.5f&#x00A0;*&#x00A0;(&#x00A0;y1&#x00A0;+&#x00A0;y2&#x00A0;-&#x00A0;ny&#x00A0;*&#x00A0;scale&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31078r38"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;ytop&#x00A0;&#x00A0;&#x00A0;&#x00A0;=&#x00A0;0.5f&#x00A0;*&#x00A0;(&#x00A0;y1&#x00A0;+&#x00A0;y2&#x00A0;+&#x00A0;ny&#x00A0;*&#x00A0;scale&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-31080r39"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31082r40"></a>&#x00A0;&#x00A0;/*&#x00A0;Set&#x00A0;up&#x00A0;a&#x00A0;PGPLOT&#x00A0;coordinate&#x00A0;transformation&#x00A0;matrix&#x00A0;and&#x00A0;display&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-31084r41"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;image&#x00A0;data&#x00A0;as&#x00A0;a&#x00A0;grey&#x00A0;scale&#x00A0;map&#x00A0;(these&#x00A0;details&#x00A0;are&#x00A0;specific&#x00A0;to
<br class="fancyvrb" /><a 
 id="x4-31086r42"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PGPLOT).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31088r43"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-31090r44"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;float&#x00A0;tr[]&#x00A0;=&#x00A0;{&#x00A0;xleft&#x00A0;-&#x00A0;0.5f&#x00A0;*&#x00A0;scale,&#x00A0;scale,&#x00A0;0.0f,
<br class="fancyvrb" /><a 
 id="x4-31092r45"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;ybottom&#x00A0;-&#x00A0;0.5f&#x00A0;*&#x00A0;scale,&#x00A0;0.0f,&#x00A0;scale&#x00A0;};
<br class="fancyvrb" /><a 
 id="x4-31094r46"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpggray(&#x00A0;data,&#x00A0;nx,&#x00A0;ny,&#x00A0;1,&#x00A0;nx,&#x00A0;1,&#x00A0;ny,&#x00A0;hi,&#x00A0;lo,&#x00A0;tr&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31096r47"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-31098r48"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31100r49"></a>&#x00A0;&#x00A0;/*&#x00A0;BEGINNING&#x00A0;OF&#x00A0;AST&#x00A0;BIT&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31102r50"></a>&#x00A0;&#x00A0;/*&#x00A0;====================&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31104r51"></a>&#x00A0;&#x00A0;/*&#x00A0;Store&#x00A0;the&#x00A0;locations&#x00A0;of&#x00A0;the&#x00A0;bottom&#x00A0;left&#x00A0;and&#x00A0;top&#x00A0;right&#x00A0;corners&#x00A0;of&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-31106r52"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;region&#x00A0;used&#x00A0;to&#x00A0;display&#x00A0;the&#x00A0;image,&#x00A0;in&#x00A0;graphics&#x00A0;coordinates.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31108r53"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{<br class="fancyvrb" /><a 
 id="x4-31110r54"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;float&#x00A0;gbox[]&#x00A0;=&#x00A0;{&#x00A0;xleft,&#x00A0;ybottom,&#x00A0;xright,&#x00A0;ytop&#x00A0;};<br class="fancyvrb" /><a 
 id="x4-31112r55"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-31114r56"></a>&#x00A0;&#x00A0;/*&#x00A0;Similarly,&#x00A0;store&#x00A0;the&#x00A0;locations&#x00A0;of&#x00A0;the&#x00A0;image&#x2019;s&#x00A0;bottom&#x00A0;left&#x00A0;and&#x00A0;top
<br class="fancyvrb" /><a 
 id="x4-31116r57"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;right&#x00A0;corners,&#x00A0;in&#x00A0;pixel&#x00A0;coordinates&#x00A0;--&#x00A0;with&#x00A0;the&#x00A0;first&#x00A0;pixel&#x00A0;centred
<br class="fancyvrb" /><a 
 id="x4-31118r58"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;at&#x00A0;(1,1).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31120r59"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;double&#x00A0;pbox[]&#x00A0;=&#x00A0;{&#x00A0;0.5,&#x00A0;0.5,&#x00A0;nx&#x00A0;+&#x00A0;0.5,&#x00A0;ny&#x00A0;+&#x00A0;0.5&#x00A0;};
<br class="fancyvrb" /><a 
 id="x4-31122r60"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31124r61"></a>&#x00A0;&#x00A0;/*&#x00A0;Create&#x00A0;a&#x00A0;Plot,&#x00A0;based&#x00A0;on&#x00A0;the&#x00A0;FrameSet&#x00A0;associated&#x00A0;with&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-31126r62"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;image.&#x00A0;This&#x00A0;attaches&#x00A0;the&#x00A0;Plot&#x00A0;to&#x00A0;the&#x00A0;graphics&#x00A0;surface&#x00A0;so&#x00A0;that&#x00A0;it
                                                                                       

                                                                                       
<br class="fancyvrb" /><a 
 id="x4-31128r63"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;matches&#x00A0;the&#x00A0;displayed&#x00A0;image.&#x00A0;Specify&#x00A0;that&#x00A0;a&#x00A0;complete&#x00A0;set&#x00A0;of&#x00A0;grid
<br class="fancyvrb" /><a 
 id="x4-31130r64"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;lines&#x00A0;should&#x00A0;be&#x00A0;drawn&#x00A0;(rather&#x00A0;than&#x00A0;just&#x00A0;coordinate&#x00A0;axes).&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31132r65"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;plot&#x00A0;=&#x00A0;astPlot(&#x00A0;wcsinfo,&#x00A0;gbox,&#x00A0;pbox,&#x00A0;&#x0022;Grid=1&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31134r66"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-31136r67"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-31138r68"></a>&#x00A0;&#x00A0;/*&#x00A0;Optionally,&#x00A0;we&#x00A0;can&#x00A0;now&#x00A0;set&#x00A0;other&#x00A0;Plot&#x00A0;attributes&#x00A0;to&#x00A0;control&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-31140r69"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;appearance&#x00A0;of&#x00A0;the&#x00A0;grid.&#x00A0;The&#x00A0;values&#x00A0;assigned&#x00A0;here&#x00A0;use&#x00A0;the
<br class="fancyvrb" /><a 
 id="x4-31142r70"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;colour/font&#x00A0;indices&#x00A0;defined&#x00A0;by&#x00A0;the&#x00A0;underlying&#x00A0;graphics&#x00A0;system.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31144r71"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astSet(&#x00A0;plot,&#x00A0;&#x0022;Colour(grid)=2,&#x00A0;Font(textlab)=3&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31146r72"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31148r73"></a>&#x00A0;&#x00A0;/*&#x00A0;Use&#x00A0;the&#x00A0;Plot&#x00A0;to&#x00A0;draw&#x00A0;the&#x00A0;coordinate&#x00A0;grid.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31150r74"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astGrid(&#x00A0;plot&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31152r75"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31154r76"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;maybe&#x00A0;some&#x00A0;more&#x00A0;AST&#x00A0;graphics&#x00A0;here&#x003E;<br class="fancyvrb" /><a 
 id="x4-31156r77"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-31158r78"></a>&#x00A0;&#x00A0;/*&#x00A0;Annul&#x00A0;the&#x00A0;Plot&#x00A0;when&#x00A0;finished&#x00A0;(or&#x00A0;use&#x00A0;the&#x00A0;astBegin/astEnd&#x00A0;technique
<br class="fancyvrb" /><a 
 id="x4-31160r79"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;shown&#x00A0;earlier).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31162r80"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;plot&#x00A0;=&#x00A0;astAnnul(&#x00A0;plot&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-31164r81"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31166r82"></a>&#x00A0;&#x00A0;/*&#x00A0;END&#x00A0;OF&#x00A0;AST&#x00A0;BIT&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-31168r83"></a>&#x00A0;&#x00A0;/*&#x00A0;==============&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31170r84"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-31172r85"></a>&#x00A0;&#x00A0;/*&#x00A0;Close&#x00A0;down&#x00A0;the&#x00A0;graphics&#x00A0;system.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-31174r86"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpgend();<br class="fancyvrb" /><a 
 id="x4-31176r87"></a>&#x00A0;&#x00A0;}</div>
<!--l. 1553--><p class="noindent" >Note that once you have set up a <a 
href="sun211ss467.html#x494-6860000">Plot</a> which is aligned with a displayed image, you may also
use it to generate further graphical output of your own, specified in the image&#x2019;s world
coordinate system (such as markers to represent astronomical objects, annotation, <em>etc.</em>).
There is also a range of Plot attributes which gives control over most aspects of the output&#x2019;s
appearance. For details of the facilities available, see &#x00A7;<a 
href="sun211se21.html#x22-19600021">21<!--tex4ht:ref: ss:plots --></a> and the description of the Plot class in
Appendix&#x00A0;<a 
href="sun211se26.html#x465-6570004">D<!--tex4ht:ref: ss:classdescriptions --></a>.
<!--l. 1562--><p class="noindent" >For details of how to build a graphics program which uses PGPLOT, see &#x00A7;<a 
href="#x4-180003">3.3<!--tex4ht:ref: ss:howtobuild --></a> and the description of
the <a 
href="sun211ss501.html#x529-7210000">ast_link</a> command in Appendix&#x00A0;<a 
href="sun211se27.html#x528-7200005">E<!--tex4ht:ref: ss:commanddescriptions --></a>.
<a 
 id="x4-31177r41"></a>
<h4 class="subsectionHead"><span class="titlemark">3.17    </span> <a 
 id="x4-3200017"></a>&#x2026;Switch to Plot a Different Celestial Coordinate Grid</h4>
<!--l. 1568--><p class="noindent" >Once you have set up a <a 
href="sun211ss467.html#x494-6860000">Plot</a> to draw a coordinate grid (&#x00A7;<a 
href="#x4-3100016">3.16<!--tex4ht:ref: ss:howtoplotgrid --></a>), it is a simple matter to change things so
that the grid represents a different celestial coordinate system. For example, after creating the Plot
with <a 
href="sun211ss140.html#x165-3570000">astPlot</a>, you could use:
<div class="fancyvrb" id="fancyvrb23"> <a 
 id="x4-32002r1"></a>&#x00A0;&#x00A0;astSet(&#x00A0;plot,&#x00A0;&#x0022;System=Galactic&#x0022;&#x00A0;);</div>
<!--l. 1578--><p class="noindent" >or:
<div class="fancyvrb" id="fancyvrb24"> <a 
 id="x4-32004r1"></a>&#x00A0;&#x00A0;astSet(&#x00A0;plot,&#x00A0;&#x0022;System=FK5,&#x00A0;Equinox=J2010&#x0022;&#x00A0;);</div>
<!--l. 1585--><p class="noindent" >and any axes and/or grid drawn subsequently would represent the new celestial coordinate
system you specified. Note, however, that this will only work if the original grid
represented celestial coordinates of some kind (see &#x00A7;<a 
href="#x4-230008">3.8<!--tex4ht:ref: ss:howtotestforcelestial --></a> for how to determine if this is the
case<span class="footnote-mark"><a 
href="#fn8x0" id="fn8x0-bk"><sup class="textsuperscript">8</sup></a></span><a 
 id="x4-32005f8"></a>).
If it did not, you will get an error message.
<!--l. 1593--><p class="noindent" >For more information about the celestial coordinate systems available, see the descriptions of the
<a 
href="sun211ss413.html#x439-6310000">System</a>, <a 
href="sun211ss286.html#x312-5040000">Equinox</a> and <a 
href="sun211ss285.html#x311-5030000">Epoch</a> attributes in Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>.
<a 
 id="x4-32006r43"></a>
                                                                                       

                                                                                       
<h4 class="subsectionHead"><span class="titlemark">3.18    </span> <a 
 id="x4-3300018"></a>&#x2026;Give a User Control Over the Appearance of a Plot</h4>
<!--l. 1599--><p class="noindent" >The idea of using a <a 
href="sun211ss467.html#x494-6860000">Plot</a>&#x2019;s attributes to control the appearance of the graphical output it produces
(&#x00A7;<a 
href="#x4-3100016">3.16<!--tex4ht:ref: ss:howtoplotgrid --></a> and &#x00A7;<a 
href="#x4-3200017">3.17<!--tex4ht:ref: ss:howtoswitchgrid --></a>) can easily be extended to allow the user of a program complete control over such
matters.
<!--l. 1604--><p class="noindent" >For instance, if the file &#x201C;plot.config&#x201D; contains a series of plotting options in the form of Plot attribute
assignments (see below for an example), then we could create a Plot and implement these assignments
before producing the graphical output as follows:
<div class="fancyvrb" id="fancyvrb25"> <a 
 id="x4-33002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;stdio.h&#x003E;<br class="fancyvrb" /><a 
 id="x4-33004r2"></a>&#x00A0;&#x00A0;#define&#x00A0;MAXCHARS&#x00A0;120<br class="fancyvrb" /><a 
 id="x4-33006r3"></a>&#x00A0;&#x00A0;FILE&#x00A0;*stream;<br class="fancyvrb" /><a 
 id="x4-33008r4"></a>&#x00A0;&#x00A0;char&#x00A0;line[&#x00A0;MAXCHARS&#x00A0;+&#x00A0;2&#x00A0;];<br class="fancyvrb" /><a 
 id="x4-33010r5"></a>&#x00A0;&#x00A0;int&#x00A0;base;<br class="fancyvrb" /><a 
 id="x4-33012r6"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-33014r7"></a>&#x00A0;&#x00A0;...
<br class="fancyvrb" /><a 
 id="x4-33016r8"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-33018r9"></a>&#x00A0;&#x00A0;/*&#x00A0;Create&#x00A0;a&#x00A0;Plot&#x00A0;and&#x00A0;define&#x00A0;the&#x00A0;default&#x00A0;appearance&#x00A0;of&#x00A0;the&#x00A0;graphical<br class="fancyvrb" /><a 
 id="x4-33020r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;output&#x00A0;it&#x00A0;will&#x00A0;produce.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-33022r11"></a>&#x00A0;&#x00A0;plot&#x00A0;=&#x00A0;astPlot(&#x00A0;wcsinfo,&#x00A0;gbox,&#x00A0;pbox,<br class="fancyvrb" /><a 
 id="x4-33024r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x0022;Grid=1,&#x00A0;Colour(grid)=2,&#x00A0;Font(textlab)=3&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-33026r13"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x4-33028r14"></a>&#x00A0;&#x00A0;/*&#x00A0;Obtain&#x00A0;the&#x00A0;value&#x00A0;of&#x00A0;any&#x00A0;Plot&#x00A0;attributes&#x00A0;we&#x00A0;want&#x00A0;to&#x00A0;preserve.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-33030r15"></a>&#x00A0;&#x00A0;base&#x00A0;=&#x00A0;astGetI(&#x00A0;plot,&#x00A0;&#x0022;Base&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-33032r16"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-33034r17"></a>&#x00A0;&#x00A0;/*&#x00A0;Open&#x00A0;the&#x00A0;plot&#x00A0;configuration&#x00A0;file,&#x00A0;if&#x00A0;it&#x00A0;exists.&#x00A0;Read&#x00A0;each&#x00A0;line&#x00A0;of
<br class="fancyvrb" /><a 
 id="x4-33036r18"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;text&#x00A0;and&#x00A0;use&#x00A0;it&#x00A0;to&#x00A0;set&#x00A0;new&#x00A0;Plot&#x00A0;attribute&#x00A0;values.&#x00A0;Close&#x00A0;the&#x00A0;file
<br class="fancyvrb" /><a 
 id="x4-33038r19"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;when&#x00A0;done.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-33040r20"></a>&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;stream&#x00A0;=&#x00A0;fopen(&#x00A0;&#x0022;plot.config&#x0022;,&#x00A0;&#x0022;r&#x0022;&#x00A0;)&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x4-33042r21"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;while&#x00A0;(&#x00A0;fgets(&#x00A0;line,&#x00A0;MAXCHARS&#x00A0;+&#x00A0;2,&#x00A0;stream&#x00A0;)&#x00A0;)&#x00A0;astSet(&#x00A0;plot,&#x00A0;&#x0022;%s&#x0022;,&#x00A0;line&#x00A0;);
<br class="fancyvrb" /><a 
 id="x4-33044r22"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;close(&#x00A0;stream&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-33046r23"></a>&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x4-33048r24"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-33050r25"></a>&#x00A0;&#x00A0;/*&#x00A0;Restore&#x00A0;any&#x00A0;attribute&#x00A0;values&#x00A0;we&#x00A0;are&#x00A0;preserving.&#x00A0;*/
<br class="fancyvrb" /><a 
 id="x4-33052r26"></a>&#x00A0;&#x00A0;astSetI(&#x00A0;plot,&#x00A0;&#x0022;Base&#x0022;,&#x00A0;base&#x00A0;);<br class="fancyvrb" /><a 
 id="x4-33054r27"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x4-33056r28"></a>&#x00A0;&#x00A0;/*&#x00A0;Produce&#x00A0;the&#x00A0;graphical&#x00A0;output&#x00A0;(e.g.).&#x00A0;*/<br class="fancyvrb" /><a 
 id="x4-33058r29"></a>&#x00A0;&#x00A0;astGrid(&#x00A0;plot&#x00A0;);</div>
<!--l. 1643--><p class="noindent" >Notice that we take care that the Plot&#x2019;s <a 
href="sun211ss252.html#x278-4700000">Base</a> attribute is preserved so that the user cannot
change it. This is because graphical output will not be produced successfully if the base
<a 
href="sun211ss452.html#x479-6710000">Frame</a> does not describe the plotting surface to which we attached the Plot when we created
it.
<!--l. 1648--><p class="noindent" >The arrangement shown above allows the contents of the &#x201C;plot.config&#x201D; file to control most aspects of
the graphical output produced (including the coordinate system used; the colour, line style, thickness
and font used for each component; the positioning of axes and tick marks; the precision, format and
positioning of labels; <em>etc.</em>) <em>via</em> assignments of the form:
<div class="fancyvrb" id="fancyvrb26"> <a 
 id="x4-33060r1"></a>&#x00A0;&#x00A0;System=Galactic,&#x00A0;Equinox&#x00A0;=&#x00A0;2001<br class="fancyvrb" /><a 
 id="x4-33062r2"></a>&#x00A0;&#x00A0;Border&#x00A0;=&#x00A0;1,&#x00A0;Colour(&#x00A0;border&#x00A0;)&#x00A0;=&#x00A0;1<br class="fancyvrb" /><a 
 id="x4-33064r3"></a>&#x00A0;&#x00A0;Colour(&#x00A0;grid&#x00A0;)&#x00A0;=&#x00A0;2
<br class="fancyvrb" /><a 
 id="x4-33066r4"></a>&#x00A0;&#x00A0;DrawAxes&#x00A0;=&#x00A0;1<br class="fancyvrb" /><a 
 id="x4-33068r5"></a>&#x00A0;&#x00A0;Colour(&#x00A0;axes&#x00A0;)&#x00A0;=&#x00A0;3<br class="fancyvrb" /><a 
 id="x4-33070r6"></a>&#x00A0;&#x00A0;Digits&#x00A0;=&#x00A0;8<br class="fancyvrb" /><a 
 id="x4-33072r7"></a>&#x00A0;&#x00A0;Labelling&#x00A0;=&#x00A0;Interior</div>
<!--l. 1667--><p class="noindent" >For a more sophisticated interface, you could obviously perform pre-processing on this input&#x2014;for
example, to translate words like &#x201C;red&#x201D;, &#x201C;green&#x201D; and &#x201C;blue&#x201D; into colour indices, to permit comments
and blank lines, <em>etc.</em>
<!--l. 1672--><p class="noindent" >For a full list of the attributes that may be used to control the appearance of graphical output, see the
description of the Plot class in Appendix&#x00A0;<a 
href="sun211se26.html#x465-6570004">D<!--tex4ht:ref: ss:classdescriptions --></a>. For a complete description of each individual attribute
(<em>e.g.</em>&#x00A0;those above), see the attribute&#x2019;s entry in Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>.
                                                                                       

                                                                                       
                                                                                       

                                                                                       
<div class="footnotes"><!--l. 656--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn4x0-bk" id="fn4x0"><sup class="textsuperscript">4</sup></a></span>The Starlink Software Collection can be downloaded from <a 
href="http://www.starlink.ac.uk/Download/" class="url" >http://www.starlink.ac.uk/Download/</a>.
<!--l. 856--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn5x0-bk" id="fn5x0"><sup class="textsuperscript">5</sup></a></span>By pixel coordinates, we mean a coordinate system in which the first pixel in the image is centred on (1,1) and each pixel
is a unit square. Note that the world coordinates will not necessarily be celestial coordinates, but if they are, then they will be
in radians.
<!--l. 1159--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn6x0-bk" id="fn6x0"><sup class="textsuperscript">6</sup></a></span>If you are writing the WCS calibration to a FITS file you obviously have the choice of storing the FITS-WCS cards
directly.
<!--l. 1453--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn7x0-bk" id="fn7x0"><sup class="textsuperscript">7</sup></a></span>An interface is provided with AST that allows it to use PGPLOT (<a 
href="http://www.starlink.ac.uk/cgi-bin/htxserver/sun15.htx/sun15.html?xref_" >SUN/15</a>) for its graphics, although interfaces to other
graphics systems may also be written.
<!--l. 1590--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn8x0-bk" id="fn8x0"><sup class="textsuperscript">8</sup></a></span>Note that the methods applied to a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> may be used equally well with a Plot.                     </div> <div class="crosslinks">
<div class="copyright"><span class="pushright">Copyright (C) 2014 Science &#x0026; Technology Facilities Council</span></div> <ul class='nav'> <li class="prev"> <a 
href="sun211se2.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World
Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se4.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li> </ul></div>
<!--l. 1679--><p class="noindent" ><a 
 id="tailsun211se3.html"></a> 
</body> 
</html>