<!DOCTYPE html> 
<html> 
<head><title>Using Foreign FITS Encodings</title> 
<meta charset=utf-8/> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<link rel="stylesheet" type="text/css" href="sun211.css" /> 
 <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=MML_HTMLorMML"></script><style type="text/css">.MathJax_MathML {text-indent: 0;}</style></head><body 
>
<div class="crosslinks"><ul class='nav'> <li class="prev"> <a 
href="sun211se16.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se18.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li>
</ul></div>
<h3 class="sectionHead"><span class="titlemark">17    </span> <a 
 id="x18-17200017"></a>Using Foreign FITS Encodings</h3>
<div class="sectionTOCS">
&#x00A0;<span class="subsectionToc" >17.1 <a 
href="#x18-1730001">The Foreign FITS Encodings</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.2 <a 
href="#x18-1740002">Limitations of Foreign Encodings</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.3 <a 
href="#x18-1750003">Identifying Foreign Encodings on Input</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.4 <a 
href="#x18-1760004">Reading Foreign WCS Information from a FITS Header</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.5 <a 
href="#x18-1770005">Removing WCS Information from FITS Headers&#x2014;the Destructive Read</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.6 <a 
href="#x18-1780006">Propagating WCS Information through Data Processing Steps</a></span>
<br />&#x00A0;<span class="subsectionToc" >17.7 <a 
href="#x18-1790007">Writing Foreign WCS Information to a FITS Header</a></span>
</div>
<!--l. 8950--><p class="noindent" >We saw in the previous section (&#x00A7;<a 
href="sun211se16.html#x17-15700016">16<!--tex4ht:ref: ss:nativefits --></a>) how to store and retrieve any kind of AST <a 
href="sun211ss464.html#x491-6830000">Object</a> in a FITS
header by using a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a>. To achieve this, we set the FitsChan&#x2019;s <a 
href="sun211ss284.html#x310-5020000">Encoding</a> attribute to NATIVE.
However, the Objects we wrote could then only be read back by other programs that use
AST.
<!--l. 8956--><p class="noindent" >In practice, we will also encounter FITS headers containing WCS information written by other
software systems. We will probably also need to write FITS headers in a format that can be
understood by these systems. Indeed, this interchange of data is one of the main reasons
for the existence of FITS, so in this section we will examine how to accommodate these
requirements.
<a 
 id="x18-172001r188"></a>
<h4 class="subsectionHead"><span class="titlemark">17.1    </span> <a 
 id="x18-1730001"></a>The Foreign FITS Encodings</h4>
<!--l. 8965--><p class="noindent" >As mentioned previously (&#x00A7;<a 
href="sun211se16.html#x17-1580001">16.1<!--tex4ht:ref: ss:nativeencoding --></a>), there are a number of conventions currently in use for
storing WCS information in FITS headers, which we call <em>encodings</em>. Here, we are concerned
with those encodings defined by software systems other than AST, which we term <em>foreign
encodings</em>.
<!--l. 8971--><p class="noindent" >Currently, AST supports six foreign encodings, which may be selected by setting the <a 
href="sun211ss284.html#x310-5020000">Encoding</a>
attribute of a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> to one of the following (character string) values:
                                                                                       

                                                                                       
     <div class="quote">
     <dl class="description"><dt class="description">
DSS </dt><dd 
class="description"><br 
class="newline" />This  encoding  stores  WCS  information  using  the  convention  developed  at
     the  Space  Telescope  Science  Institute  for  the  Digitised  Sky  Survey  (DSS)
     astrometric  plate  calibrations.  DSS  images  which  use  this  convention  are
     widely   available   and   it   is   understood   by   a   number   of   important   and
     well-established astronomy applications.
     <!--l. 8984--><p class="noindent" >However, the calibration model used (based on a polynomial fit) is not easily
     applicable  to  other  types  of  data  and  creating  the  polynomial  coefficients
     needed to calibrate your own images can prove difficult. For this reason, the
     DSS encoding is probably best viewed as a &#x201C;read-only&#x201D; format. It is possible,
     however, to read in WCS information using this encoding and then to write it
     back out again, so long as only minor changes have been made.
     </dd><dt class="description">
FITS-WCS </dt><dd 
class="description"><br 
class="newline" />This encoding is very important because it is based on a new FITS standard
     which should, for the first time, address the problem of celestial coordinate
     systems  in  a  proper  manner,  by  considerably  extending  the  original  FITS
     standard.
     <!--l. 8998--><p class="noindent" >The  conventions  used  are  described  in  a  series  of  papers  by  E.W. Greisen,
     M. Calabretta,  <em>et.  al.</em>,  often  referred  to  as  the  &#x201C;FITS-WCS  papers&#x201D;.  They  are
     described at <a 
href="http://fits.gsfc.nasa.gov/fits_wcs.html" class="url" >http://fits.gsfc.nasa.gov/fits_wcs.html</a>. Now that the first
     two papers in this series have been agreed, this encoding should be understood
     by any FITS-WCS compliant software and it is likely to be adopted widely for
     FITS data in future. For details of the coverage of these conventions provided
     by the FitsChan class, see Appendix&#x00A0;<a 
href="sun211se29.html#x558-7500007">G<!--tex4ht:ref: ss:fitswcscoverage --></a>.
     </dd><dt class="description">
FITS-IRAF </dt><dd 
class="description"><br 
class="newline" />This encoding is based on the conventions described in the document &#x201C;World
     Coordinate Systems Representations Within the FITS Format&#x201D; by R.J. Hanisch
     and D.G. Wells, 1988.<span class="footnote-mark"><a 
href="#fn26x0" id="fn26x0-bk"><sup class="textsuperscript">26</sup></a></span><a 
 id="x18-173001f26"></a>
     It is employed by the IRAF data analysis facility, so its use will facilitate data
     exchange with IRAF. This encoding is in effect a sub-set of the current FITS-WCS
     encoding.
     </dd><dt class="description">
FITS-PC </dt><dd 
class="description"><br 
class="newline" />This encoding is based on a previous version of the proposed new FITS WCS
     standard which used <code>PCjjjjiii</code> and <code>CDELTj</code> keywords to describe axis rotation
     and scaling. Versions of AST prior to V1.5 used this scheme for the FITS-WCS
     encoding. As of V1.5, FITS-WCS uses <code>CDi_j</code> keywords instead.<span class="footnote-mark"><a 
href="#fn27x0" id="fn27x0-bk"><sup class="textsuperscript">27</sup></a></span><a 
 id="x18-173002f27"></a>
     The FITS-PC encoding is included in AST V1.5 only to allow FITS-WCS data
     created with previous versions to be read. It should not, in general, be used to
     create new data sets.
     </dd><dt class="description">
                                                                                       

                                                                                       
FITS-AIPS </dt><dd 
class="description"><br 
class="newline" />This encoding is based on the conventions described in the document &#x201C;Non-linear
     Coordinate Systems in AIPS&#x201D; by Eric W. Greisen (revised 9th September, 1994).<span class="footnote-mark"><a 
href="#fn28x0" id="fn28x0-bk"><sup class="textsuperscript">28</sup></a></span><a 
 id="x18-173003f28"></a>
     It is currently employed by the AIPS data analysis facility, so its use will facilitate
     data exchange with AIPS. This encoding uses <code>CROTAi</code> and <code>CDELTi</code> keywords to
     describe axis rotation and scaling.
     </dd><dt class="description">
FITS-AIPS++ </dt><dd 
class="description"><br 
class="newline" />Encodes  coordinate  system  information  in  FITS  header  cards  using  the
     conventions  used  by  the  AIPS++  project.  This  is  an  extension  of  FITS-AIPS
     which includes some of the features of FITS-PC and FITS-IRAF.</dd></dl>
     </div>
<!--l. 9045--><p class="noindent" >For more detail about the above encodings, see the description of the Encoding attribute in
Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>.
<a 
 id="x18-173004r190"></a>
<h4 class="subsectionHead"><span class="titlemark">17.2    </span> <a 
 id="x18-1740002"></a>Limitations of Foreign Encodings</h4>
<!--l. 9050--><p class="noindent" >The foreign encodings available for storing WCS information in FITS headers have a number of
limitations when compared with the native encoding of AST Objects (&#x00A7;<a 
href="sun211se16.html#x17-15700016">16<!--tex4ht:ref: ss:nativefits --></a>). The main ones
are:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  (1) </dt><dd 
class="enumerate-enumitem">Only one class of AST <a 
href="sun211ss464.html#x491-6830000">Object</a>, the <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>, may be represented using a foreign FITS
     encoding.  This  should  not  come  as  a  surprise,  because  the  purpose  of  storing  WCS
     information in FITS headers is to attach coordinate systems to an associated array of data.
     Since the FrameSet is the AST Object designed for the same purpose (&#x00A7;<a 
href="sun211se13.html#x14-1260004">13.4<!--tex4ht:ref: ss:baseandcurrent --></a>), there is a
     natural correspondence.
     <!--l. 9062--><p class="noindent" >The way in which a FrameSet is translated to and from the foreign encoding also follows
     from this correspondence. The FrameSet&#x2019;s base <a 
href="sun211ss452.html#x479-6710000">Frame</a> identifies the data grid coordinates
     of the associated FITS data. These are the same as FITS pixel coordinates, in which the
     first pixel (in 2 dimensions) has coordinates (1,1) at its centre. Similarly, the current Frame
     of the FrameSet identifies the FITS world coordinate system associated with the data.
     </dd><dt class="enumerate-enumitem">
  (2) </dt><dd 
class="enumerate-enumitem">You may store a representation of only a single FrameSet in any individual set of FITS
     header cards (<em>i.e.</em>&#x00A0;in a single <a 
href="sun211ss449.html#x476-6680000">FitsChan</a>) at one time. If you attempt to store more than one,
     you may over-write the previous one or generate an invalid representation of your WCS
     information.
     <!--l. 9076--><p class="noindent" >This is mainly a consequence of the use of fixed FITS keywords by foreign encodings and
     the fact that you cannot, in general, have multiple FITS cards with the same keyword.
     </dd><dt class="enumerate-enumitem">
  (3) </dt><dd 
class="enumerate-enumitem">In  general,  it  will  not  be  possible  to  store  every  possible  FrameSet  that  you  might
     construct. Depending on the encoding, only certain FrameSets that conform to particular
     restrictions can be represented and, even then, some of their information may be lost.
     See the description of the <a 
href="sun211ss284.html#x310-5020000">Encoding</a> attribute in Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a> for more details of these
     limitations.</dd></dl>
                                                                                       

                                                                                       
<!--l. 9089--><p class="noindent" >It should be understood that using foreign encodings to read and write information held in AST
Objects is essentially a process of converting the data format. As such, it potentially suffers from the
same problems faced by all such processes, <em>i.e.</em>&#x00A0;differences between the AST data model and that of
the foreign encoding may cause some information to be lost. Because the AST model is extremely
flexible, however, any data loss can largely be eliminated when reading. Instead, this effect manifests
itself in the form of the above encoding-dependent restrictions on the kind of AST Objects which may
be written.
<!--l. 9100--><p class="noindent" >One of the aims of the AST library, of course, is to insulate you from the details of these
foreign encodings and the restrictions they impose. We will see shortly, therefore, how
AST provides a mechanism for determining whether your WCS information satisfies the
necessary conditions and allows you to make an automatic choice of which encoding to
use.
<a 
 id="x18-174004r191"></a>
<h4 class="subsectionHead"><span class="titlemark">17.3    </span> <a 
 id="x18-1750003"></a>Identifying Foreign Encodings on Input</h4>
<!--l. 9109--><p class="noindent" >Let us now examine the practicalities of extracting WCS information from a set of FITS header cards
which have been written by some other software system. We will pretend that our program does not
know which encoding has been used for the WCS information and must discover this for itself. In
order to have a concrete example, however, we will use the following set of cards. These use the
FITS-AIPS encoding and contain a typical mix of other FITS cards which are irrelevant to the WCS
information in which we are interested:
<div class="fancyvrb" id="fancyvrb203"> <a 
 id="x18-175002r1"></a>&#x00A0;&#x00A0;SIMPLE&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;T&#x00A0;/&#x00A0;Written&#x00A0;by&#x00A0;IDL:&#x00A0;&#x00A0;30-Jul-1997&#x00A0;05:35:42.00<br class="fancyvrb" /><a 
 id="x18-175004r2"></a>&#x00A0;&#x00A0;BITPIX&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;-32&#x00A0;/&#x00A0;Bits&#x00A0;per&#x00A0;pixel.
<br class="fancyvrb" /><a 
 id="x18-175006r3"></a>&#x00A0;&#x00A0;NAXIS&#x00A0;&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;2&#x00A0;/&#x00A0;Number&#x00A0;of&#x00A0;dimensions<br class="fancyvrb" /><a 
 id="x18-175008r4"></a>&#x00A0;&#x00A0;NAXIS1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;300&#x00A0;/&#x00A0;Length&#x00A0;of&#x00A0;x&#x00A0;axis.
<br class="fancyvrb" /><a 
 id="x18-175010r5"></a>&#x00A0;&#x00A0;NAXIS2&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;300&#x00A0;/&#x00A0;Length&#x00A0;of&#x00A0;y&#x00A0;axis.<br class="fancyvrb" /><a 
 id="x18-175012r6"></a>&#x00A0;&#x00A0;CTYPE1&#x00A0;&#x00A0;=&#x00A0;&#x2019;GLON-ZEA&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;X-axis&#x00A0;type
<br class="fancyvrb" /><a 
 id="x18-175014r7"></a>&#x00A0;&#x00A0;CTYPE2&#x00A0;&#x00A0;=&#x00A0;&#x2019;GLAT-ZEA&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Y-axis&#x00A0;type<br class="fancyvrb" /><a 
 id="x18-175016r8"></a>&#x00A0;&#x00A0;CRVAL1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;-149.56866&#x00A0;/&#x00A0;Reference&#x00A0;pixel&#x00A0;value
<br class="fancyvrb" /><a 
 id="x18-175018r9"></a>&#x00A0;&#x00A0;CRVAL2&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;-19.758201&#x00A0;/&#x00A0;Reference&#x00A0;pixel&#x00A0;value
<br class="fancyvrb" /><a 
 id="x18-175020r10"></a>&#x00A0;&#x00A0;CRPIX1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;150.500&#x00A0;/&#x00A0;Reference&#x00A0;pixel<br class="fancyvrb" /><a 
 id="x18-175022r11"></a>&#x00A0;&#x00A0;CRPIX2&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;150.500&#x00A0;/&#x00A0;Reference&#x00A0;pixel
<br class="fancyvrb" /><a 
 id="x18-175024r12"></a>&#x00A0;&#x00A0;CDELT1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;-1.20000&#x00A0;/&#x00A0;Degrees/pixel<br class="fancyvrb" /><a 
 id="x18-175026r13"></a>&#x00A0;&#x00A0;CDELT2&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;1.20000&#x00A0;/&#x00A0;Degrees/pixel
<br class="fancyvrb" /><a 
 id="x18-175028r14"></a>&#x00A0;&#x00A0;CROTA1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;0.00000&#x00A0;/&#x00A0;Rotation&#x00A0;in&#x00A0;degrees.<br class="fancyvrb" /><a 
 id="x18-175030r15"></a>&#x00A0;&#x00A0;SURVEY&#x00A0;&#x00A0;=&#x00A0;&#x2019;COBE&#x00A0;DIRBE&#x2019;
<br class="fancyvrb" /><a 
 id="x18-175032r16"></a>&#x00A0;&#x00A0;BUNITS&#x00A0;&#x00A0;=&#x00A0;&#x2019;MJy/sr&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/<br class="fancyvrb" /><a 
 id="x18-175034r17"></a>&#x00A0;&#x00A0;ORIGIN&#x00A0;&#x00A0;=&#x00A0;&#x2019;CDAC&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Cosmology&#x00A0;Data&#x00A0;Analysis&#x00A0;Center
<br class="fancyvrb" /><a 
 id="x18-175036r18"></a>&#x00A0;&#x00A0;TELESCOP=&#x00A0;&#x2019;COBE&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;COsmic&#x00A0;Background&#x00A0;Explorer&#x00A0;satellite
<br class="fancyvrb" /><a 
 id="x18-175038r19"></a>&#x00A0;&#x00A0;INSTRUME=&#x00A0;&#x2019;DIRBE&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;COBE&#x00A0;instrument&#x00A0;[DIRBE,&#x00A0;DMR,&#x00A0;FIRAS]
<br class="fancyvrb" /><a 
 id="x18-175040r20"></a>&#x00A0;&#x00A0;PIXRESOL=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;9&#x00A0;/&#x00A0;Quad&#x00A0;tree&#x00A0;pixel&#x00A0;resolution&#x00A0;[6,&#x00A0;9]
<br class="fancyvrb" /><a 
 id="x18-175042r21"></a>&#x00A0;&#x00A0;DATE&#x00A0;&#x00A0;&#x00A0;&#x00A0;=&#x00A0;&#x2019;27/09/94&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;FITS&#x00A0;file&#x00A0;creation&#x00A0;date&#x00A0;(dd/mm/yy)
<br class="fancyvrb" /><a 
 id="x18-175044r22"></a>&#x00A0;&#x00A0;DATE-MAP=&#x00A0;&#x2019;16/09/94&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;Date&#x00A0;of&#x00A0;original&#x00A0;file&#x00A0;creation&#x00A0;(dd/mm/yy)<br class="fancyvrb" /><a 
 id="x18-175046r23"></a>&#x00A0;&#x00A0;COMMENT&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;COBE&#x00A0;specific&#x00A0;keywords
<br class="fancyvrb" /><a 
 id="x18-175048r24"></a>&#x00A0;&#x00A0;DATE-BEG=&#x00A0;&#x2019;08/12/89&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;date&#x00A0;of&#x00A0;initial&#x00A0;data&#x00A0;represented&#x00A0;(dd/mm/yy)
<br class="fancyvrb" /><a 
 id="x18-175050r25"></a>&#x00A0;&#x00A0;DATE-END=&#x00A0;&#x2019;25/09/90&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;date&#x00A0;of&#x00A0;final&#x00A0;data&#x00A0;represented&#x00A0;&#x00A0;&#x00A0;(dd/mm/yy)</div>
<!--l. 9148--><p class="noindent" >The first step is to create a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> and insert these cards into it. If &#x201C;cards&#x201D; is an array of pointers to
character strings holding the header cards and &#x201C;ncards&#x201D; is the number of cards, this could be done as
follows:
<div class="fancyvrb" id="fancyvrb204"> <a 
 id="x18-175052r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x0022;ast.h&#x0022;<br class="fancyvrb" /><a 
 id="x18-175054r2"></a>&#x00A0;&#x00A0;#define&#x00A0;MAXCARD&#x00A0;100<br class="fancyvrb" /><a 
 id="x18-175056r3"></a>&#x00A0;&#x00A0;AstFitsChan&#x00A0;*fitschan;<br class="fancyvrb" /><a 
 id="x18-175058r4"></a>&#x00A0;&#x00A0;char&#x00A0;*cards[&#x00A0;MAXCARD&#x00A0;];
<br class="fancyvrb" /><a 
 id="x18-175060r5"></a>&#x00A0;&#x00A0;int&#x00A0;icard,&#x00A0;ncard;<br class="fancyvrb" /><a 
 id="x18-175062r6"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-175064r7"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x18-175066r8"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-175068r9"></a>&#x00A0;&#x00A0;fitschan&#x00A0;=&#x00A0;astFitsChan(&#x00A0;NULL,&#x00A0;NULL,&#x00A0;&#x0022;&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x18-175070r10"></a>&#x00A0;&#x00A0;for&#x00A0;(&#x00A0;icard&#x00A0;=&#x00A0;0;&#x00A0;icard&#x00A0;&#x003C;&#x00A0;ncard;&#x00A0;icard++&#x00A0;)&#x00A0;astPutFits(&#x00A0;fitschan,&#x00A0;cards[&#x00A0;icard&#x00A0;],&#x00A0;0&#x00A0;);</div>
                                                                                       

                                                                                       
<!--l. 9168--><p class="noindent" >Note that we have not initialised the <a 
href="sun211ss284.html#x310-5020000">Encoding</a> attribute of the FitsChan as we did in &#x00A7;<a 
href="sun211se16.html#x17-1600003">16.3<!--tex4ht:ref: ss:creatingafitschan --></a> when we
wanted to use the native encoding. This is because we are pretending not to know which encoding to
use and want AST to determine this for us. By leaving the Encoding attribute un-set, its default value
will adjust to whichever encoding AST considers to be most appropriate, according to the FITS header
cards present. For details of how this choice is made, see the description of the Encoding attribute in
Appendix&#x00A0;<a 
href="sun211se25.html#x266-4580003">C<!--tex4ht:ref: ss:attributedescriptions --></a>.
<!--l. 9178--><p class="noindent" >This approach has the obvious advantages of making our program simpler and more flexible and of
freeing us from having to know about the different encodings available. As a bonus, it also means that
the program will be able to read any new encodings that AST may support in future, without needing
to be changed.
<!--l. 9184--><p class="noindent" >At this point, we could enquire the default value of the Encoding attribute, which indicates which
encoding AST intends to use, as follows:
<div class="fancyvrb" id="fancyvrb205"> <a 
 id="x18-175072r1"></a>&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*encode;<br class="fancyvrb" /><a 
 id="x18-175074r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-175076r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x18-175078r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-175080r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-175082r6"></a>&#x00A0;&#x00A0;encode&#x00A0;=&#x00A0;astGetC(&#x00A0;fitschan,&#x00A0;&#x0022;Encoding&#x0022;&#x00A0;);</div>
<!--l. 9199--><p class="noindent" >The result of this enquiry would be the string &#x201C;FITS-AIPS&#x201D;. Note that we could also have set the
FitsChan&#x2019;s Encoding attribute explicitly, such as when creating it:
<div class="fancyvrb" id="fancyvrb206"> <a 
 id="x18-175084r1"></a>&#x00A0;&#x00A0;fitschan&#x00A0;=&#x00A0;astFitsChan(&#x00A0;NULL,&#x00A0;NULL,&#x00A0;&#x0022;Encoding=FITS-AIPS&#x0022;&#x00A0;);</div>
<!--l. 9209--><p class="noindent" >If we tried to read information using this encoding (&#x00A7;<a 
href="#x18-1760004">17.4<!--tex4ht:ref: ss:readingforeignfits --></a>), but failed, we could then change the
encoding and try again. This would allow our program to take control of how the optimum choice of
encoding is arrived at. However, it would also involve using explicit knowledge of the encodings
available and this is best avoided if possible.
<a 
 id="x18-175085r192"></a>
<h4 class="subsectionHead"><span class="titlemark">17.4    </span> <a 
 id="x18-1760004"></a>Reading Foreign WCS Information from a FITS Header</h4>
<!--l. 9218--><p class="noindent" >Having stored a set of FITS header cards in a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> and determined how the WCS information is
encoded (&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>), the next step is to read an AST <a 
href="sun211ss464.html#x491-6830000">Object</a> from the FitsChan using <a 
href="sun211ss160.html#x185-3770000">astRead</a>. We must also
remember to rewind the FitsChan first, if necessary, such as by clearing its <a 
href="sun211ss258.html#x284-4760000">Card</a> attribute, which
defaults to 1:
<div class="fancyvrb" id="fancyvrb207"> <a 
 id="x18-176002r1"></a>&#x00A0;&#x00A0;AstObject&#x00A0;*wcsinfo;<br class="fancyvrb" /><a 
 id="x18-176004r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-176006r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x18-176008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-176010r5"></a>&#x00A0;&#x00A0;astClear(&#x00A0;fitschan,&#x00A0;&#x0022;Card&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-176012r6"></a>&#x00A0;&#x00A0;wcsinfo&#x00A0;=&#x00A0;astRead(&#x00A0;fitschan&#x00A0;);</div>
<!--l. 9236--><p class="noindent" >If the pointer returned by astRead is not equal to AST__NULL, then an Object has been read
successfully. Otherwise, there was either no information to read or the choice of FITS encoding (&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>)
was inappropriate.
<!--l. 9241--><p class="noindent" >At this point you might like to indulge in a little data validation along the lines described in &#x00A7;<a 
href="sun211se15.html#x16-1470006">15.6<!--tex4ht:ref: ss:validatinginput --></a>, for
example:
<div class="fancyvrb" id="fancyvrb208"> <a 
 id="x18-176014r1"></a>&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!strcmp(&#x00A0;astGetC(&#x00A0;wcsinfo,&#x00A0;&#x0022;Class&#x0022;&#x00A0;),&#x00A0;&#x0022;FrameSet&#x0022;&#x00A0;)&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x18-176016r2"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;the&#x00A0;Object&#x00A0;is&#x00A0;a&#x00A0;FrameSet,&#x00A0;so&#x00A0;use&#x00A0;it&#x003E;<br class="fancyvrb" /><a 
 id="x18-176018r3"></a>&#x00A0;&#x00A0;}&#x00A0;else&#x00A0;{<br class="fancyvrb" /><a 
 id="x18-176020r4"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x003C;something&#x00A0;unexpected&#x00A0;was&#x00A0;read&#x003E;<br class="fancyvrb" /><a 
 id="x18-176022r5"></a>&#x00A0;&#x00A0;}</div>
                                                                                       

                                                                                       
<!--l. 9254--><p class="noindent" >If a foreign encoding has definitely been used, then the Object will automatically be a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>
(&#x00A7;<a 
href="#x18-1740002">17.2<!--tex4ht:ref: ss:foreignfitslimitations --></a>), so this stage can be omitted. However, if the native encoding (&#x00A7;<a 
href="sun211se16.html#x17-1580001">16.1<!--tex4ht:ref: ss:nativeencoding --></a>) might have been
employed, which is a possibility if you accept the FitsChan&#x2019;s default <a 
href="sun211ss284.html#x310-5020000">Encoding</a> value, then any class of
Object might have been read and a quick check would be worthwhile.
<!--l. 9262--><p class="noindent" >If you used <a 
href="sun211ss187.html#x212-4040000">astShow</a> (&#x00A7;<a 
href="sun211se4.html#x5-380004">4.4<!--tex4ht:ref: ss:displayingobjects --></a>) to examine the FrameSet which results from reading our example FITS
header (&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>), you would find that its base <a 
href="sun211ss452.html#x479-6710000">Frame</a> describes the image&#x2019;s pixel coordinate
system and that its current Frame is a <a 
href="sun211ss478.html#x505-6970000">SkyFrame</a> representing galactic coordinates. These
two Frames are inter-related by a <a 
href="sun211ss459.html#x486-6780000">Mapping</a> (actually a <a 
href="sun211ss444.html#x471-6630000">CmpMap</a>) which incorporates the
effects of various rotations, scalings and a &#x201C;zenithal equal area&#x201D; sky projection, so that
each pixel of the FITS image is mapped on to a corresponding sky position in galactic
coordinates.
<!--l. 9273--><p class="noindent" >Because this FrameSet may be used both as a Mapping (&#x00A7;<a 
href="sun211se13.html#x14-1280006">13.6<!--tex4ht:ref: ss:framesetasmapping --></a>) and as a Frame (&#x00A7;<a 
href="sun211se13.html#x14-1300008">13.8<!--tex4ht:ref: ss:framesetasframe --></a>), it may be
employed directly to perform many useful operations without any need to decompose it into its
component parts. These include:
     <ul class="itemize1">
     <li class="itemize">Transforming data grid (FITS pixel) coordinates into galactic coordinates and <em>vice versa</em>
     (&#x00A7;<a 
href="sun211se13.html#x14-1280006">13.6<!--tex4ht:ref: ss:framesetasmapping --></a>).
     </li>
     <li class="itemize">Formatting coordinate values (either pixel or galactic coordinates) ready for display to a
     user (&#x00A7;<a 
href="sun211se7.html#x8-790006">7.6<!--tex4ht:ref: ss:formattingaxisvalues --></a> and &#x00A7;<a 
href="sun211se7.html#x8-800007">7.7<!--tex4ht:ref: ss:normalising --></a>).
     </li>
     <li class="itemize">Enquiring about axis labels (or other axis information&#x2014;&#x00A7;<a 
href="sun211se7.html#x8-780005">7.5<!--tex4ht:ref: ss:frameattributes --></a>) which might be used, for
     example, to label columns of coordinates in a table (&#x00A7;<a 
href="sun211se7.html#x8-770004">7.4<!--tex4ht:ref: ss:frameaxisattributes --></a>).
     </li>
     <li class="itemize">Aligning the image with another image from which a similar FrameSet has been obtained
     (&#x00A7;<a 
href="sun211se14.html#x15-1360003">14.3<!--tex4ht:ref: ss:registeringimages --></a>).
     </li>
     <li class="itemize">Creating a <a 
href="sun211ss467.html#x494-6860000">Plot</a> (&#x00A7;<a 
href="sun211se21.html#x22-19600021">21<!--tex4ht:ref: ss:plots --></a>), which can be used to overlay a variety of graphical information
     (including a coordinate grid&#x2014;Figure&#x00A0;<a 
href="sun211se2.html#x3-140018">8<!--tex4ht:ref: fig:gridplot --></a>) on the displayed image.
     </li>
     <li class="itemize">Generating a new FrameSet which reflects any geometrical processing you perform on
     the associated image data (&#x00A7;<a 
href="sun211se14.html#x15-1380005">14.5<!--tex4ht:ref: ss:wcsprocessingexample --></a>). This new FrameSet could then be written out as FITS
     headers to describe the modified image (&#x00A7;<a 
href="#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>).</li></ul>
<!--l. 9306--><p class="noindent" >If the FrameSet contains other Frames (apart from the base and current Frames), then you
would also have access to information about other coordinate systems associated with the
image.
<a 
 id="x18-176023r193"></a>
<h4 class="subsectionHead"><span class="titlemark">17.5    </span> <a 
 id="x18-1770005"></a>Removing WCS Information from FITS Headers&#x2014;the Destructive Read</h4>
<!--l. 9312--><p class="noindent" >It is instructive at this point to examine the contents of a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> after we have read a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> from
it (&#x00A7;<a 
href="#x18-1760004">17.4<!--tex4ht:ref: ss:readingforeignfits --></a>). The following would rewind our FitsChan and display its contents:
                                                                                       

                                                                                       
<div class="fancyvrb" id="fancyvrb209"> <a 
 id="x18-177002r1"></a>&#x00A0;&#x00A0;#include&#x00A0;&#x003C;stdio.h&#x003E;<br class="fancyvrb" /><a 
 id="x18-177004r2"></a>&#x00A0;&#x00A0;char&#x00A0;card[&#x00A0;81&#x00A0;];<br class="fancyvrb" /><a 
 id="x18-177006r3"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-177008r4"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x18-177010r5"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-177012r6"></a>&#x00A0;&#x00A0;astClear(&#x00A0;fitschan,&#x00A0;&#x0022;Card&#x0022;&#x00A0;);
<br class="fancyvrb" /><a 
 id="x18-177014r7"></a>&#x00A0;&#x00A0;while&#x00A0;(&#x00A0;astFindFits(&#x00A0;fitschan,&#x00A0;&#x0022;%f&#x0022;,&#x00A0;card,&#x00A0;1&#x00A0;)&#x00A0;)&#x00A0;(void)&#x00A0;printf(&#x00A0;&#x0022;%s&#x005C;n&#x0022;,&#x00A0;card&#x00A0;);</div>
<!--l. 9329--><p class="noindent" >The output, if we started with the example FITS header in &#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>, might look like this:
<div class="fancyvrb" id="fancyvrb210"> <a 
 id="x18-177016r1"></a>&#x00A0;&#x00A0;SIMPLE&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;T&#x00A0;/&#x00A0;&#x00A0;Written&#x00A0;by&#x00A0;IDL:&#x00A0;&#x00A0;30-Jul-1997&#x00A0;05:35:42.00
<br class="fancyvrb" /><a 
 id="x18-177018r2"></a>&#x00A0;&#x00A0;BITPIX&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;-32&#x00A0;/&#x00A0;&#x00A0;Bits&#x00A0;per&#x00A0;pixel.<br class="fancyvrb" /><a 
 id="x18-177020r3"></a>&#x00A0;&#x00A0;NAXIS&#x00A0;&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;2&#x00A0;/&#x00A0;&#x00A0;Number&#x00A0;of&#x00A0;dimensions
<br class="fancyvrb" /><a 
 id="x18-177022r4"></a>&#x00A0;&#x00A0;NAXIS1&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;300&#x00A0;/&#x00A0;&#x00A0;Length&#x00A0;of&#x00A0;x&#x00A0;axis.<br class="fancyvrb" /><a 
 id="x18-177024r5"></a>&#x00A0;&#x00A0;NAXIS2&#x00A0;&#x00A0;=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;300&#x00A0;/&#x00A0;&#x00A0;Length&#x00A0;of&#x00A0;y&#x00A0;axis.
<br class="fancyvrb" /><a 
 id="x18-177026r6"></a>&#x00A0;&#x00A0;SURVEY&#x00A0;&#x00A0;=&#x00A0;&#x2019;COBE&#x00A0;DIRBE&#x2019;<br class="fancyvrb" /><a 
 id="x18-177028r7"></a>&#x00A0;&#x00A0;BUNITS&#x00A0;&#x00A0;=&#x00A0;&#x2019;MJy/sr&#x00A0;&#x00A0;&#x2019;<br class="fancyvrb" /><a 
 id="x18-177030r8"></a>&#x00A0;&#x00A0;ORIGIN&#x00A0;&#x00A0;=&#x00A0;&#x2019;CDAC&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;Cosmology&#x00A0;Data&#x00A0;Analysis&#x00A0;Center
<br class="fancyvrb" /><a 
 id="x18-177032r9"></a>&#x00A0;&#x00A0;TELESCOP=&#x00A0;&#x2019;COBE&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;COsmic&#x00A0;Background&#x00A0;Explorer&#x00A0;satellite
<br class="fancyvrb" /><a 
 id="x18-177034r10"></a>&#x00A0;&#x00A0;INSTRUME=&#x00A0;&#x2019;DIRBE&#x00A0;&#x00A0;&#x00A0;&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;COBE&#x00A0;instrument&#x00A0;[DIRBE,&#x00A0;DMR,&#x00A0;FIRAS]
<br class="fancyvrb" /><a 
 id="x18-177036r11"></a>&#x00A0;&#x00A0;PIXRESOL=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;9&#x00A0;/&#x00A0;&#x00A0;Quad&#x00A0;tree&#x00A0;pixel&#x00A0;resolution&#x00A0;[6,&#x00A0;9]
<br class="fancyvrb" /><a 
 id="x18-177038r12"></a>&#x00A0;&#x00A0;DATE&#x00A0;&#x00A0;&#x00A0;&#x00A0;=&#x00A0;&#x2019;27/09/94&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;FITS&#x00A0;file&#x00A0;creation&#x00A0;date&#x00A0;(dd/mm/yy)
<br class="fancyvrb" /><a 
 id="x18-177040r13"></a>&#x00A0;&#x00A0;DATE-MAP=&#x00A0;&#x2019;16/09/94&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;Date&#x00A0;of&#x00A0;original&#x00A0;file&#x00A0;creation&#x00A0;(dd/mm/yy)<br class="fancyvrb" /><a 
 id="x18-177042r14"></a>&#x00A0;&#x00A0;COMMENT&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;COBE&#x00A0;specific&#x00A0;keywords
<br class="fancyvrb" /><a 
 id="x18-177044r15"></a>&#x00A0;&#x00A0;DATE-BEG=&#x00A0;&#x2019;08/12/89&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;date&#x00A0;of&#x00A0;initial&#x00A0;data&#x00A0;represented&#x00A0;(dd/mm/yy)
<br class="fancyvrb" /><a 
 id="x18-177046r16"></a>&#x00A0;&#x00A0;DATE-END=&#x00A0;&#x2019;25/09/90&#x2019;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/&#x00A0;&#x00A0;date&#x00A0;of&#x00A0;final&#x00A0;data&#x00A0;represented&#x00A0;&#x00A0;&#x00A0;(dd/mm/yy)</div>
<!--l. 9353--><p class="noindent" >Comparing this with the original, you can see that all the FITS cards that represent WCS information
have been removed. They have effectively been &#x201C;sucked out&#x201D; of the FitsChan by the destructive read
that <a 
href="sun211ss160.html#x185-3770000">astRead</a> performs and converted into an equivalent FrameSet. AST remembers where they were
stored, however, so that if we later write WCS information back into the FitsChan (&#x00A7;<a 
href="#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>) they will, as
far as possible, go back into their original locations. This helps to preserve the overall layout of the
FITS header.
<!--l. 9363--><p class="noindent" >You can now see why astRead performs destructive reads. It is a mechanism for removing WCS
information from a FITS header while insulating you, as a programmer, from the details of the
encoding being used. It means you can ensure that all relevant header cards have been removed,
giving you a clean slate, without having to know which FITS keywords any particular encoding
uses.
<!--l. 9370--><p class="noindent" >Clearing this WCS information out of a FITS header is particularly important when
considering how to write new WCS information back after processing (&#x00A7;<a 
href="#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>). If
any relevant FITS cards are left over from the input dataset and find their way into
the new processed header, they could interfere with the new information being
written.<span class="footnote-mark"><a 
href="#fn29x0" id="fn29x0-bk"><sup class="textsuperscript">29</sup></a></span><a 
 id="x18-177047f29"></a>
The destructive read mechanism ensures that this doesn&#x2019;t happen.
<a 
 id="x18-177048r194"></a>
<h4 class="subsectionHead"><span class="titlemark">17.6    </span> <a 
 id="x18-1780006"></a>Propagating WCS Information through Data Processing Steps</h4>
<!--l. 9385--><p class="noindent" >One of the purposes of AST is to make it feasible to propagate WCS information through successive
stages of data processing, so that it remains consistent with the associated image data. As far as
possible, this should happen regardless of the FITS encoding used to store the original WCS
information.
<!--l. 9391--><p class="noindent" >If the data processing being performed does not change the relationship between image pixel and
world coordinates (whatever these may be), then propagation of the WCS information is
straightforward. You can simply copy the FITS header from input to output.
                                                                                       

                                                                                       
<!--l. 9397--><p class="noindent" >If this relationship changes, however, then the WCS information must be processed alongside the
image data and a new FITS header generated to represent it. In this case, the sequence of operations
within your program would probably be as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  (1) </dt><dd 
class="enumerate-enumitem">Read  the  image  data  and  associated  FITS  header  from  the  input  dataset,  putting  the
     header cards into a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> (&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>).
     </dd><dt class="enumerate-enumitem">
  (2) </dt><dd 
class="enumerate-enumitem">Read  an  AST  <a 
href="sun211ss464.html#x491-6830000">Object</a>,  a  <a 
href="sun211ss453.html#x480-6720000">FrameSet</a>,  from  the  FitsChan  (typically  using  a  foreign  FITS
     encoding&#x2014;&#x00A7;<a 
href="#x18-1760004">17.4<!--tex4ht:ref: ss:readingforeignfits --></a>).
     </dd><dt class="enumerate-enumitem">
  (3) </dt><dd 
class="enumerate-enumitem">Process the image data and modify the FrameSet accordingly (<em>e.g.</em>&#x00A0;&#x00A7;<a 
href="sun211se14.html#x15-1380005">14.5<!--tex4ht:ref: ss:wcsprocessingexample --></a>).
     </dd><dt class="enumerate-enumitem">
  (4) </dt><dd 
class="enumerate-enumitem">Write the FrameSet back into the FitsChan (&#x00A7;<a 
href="#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>).
     </dd><dt class="enumerate-enumitem">
  (5) </dt><dd 
class="enumerate-enumitem">Perform any other modification of FITS header cards your program may require.
     </dd><dt class="enumerate-enumitem">
  (6) </dt><dd 
class="enumerate-enumitem">Write the FitsChan contents (<em>i.e.</em>&#x00A0;processed header cards) and image data to the output
     dataset.</dd></dl>
<!--l. 9423--><p class="noindent" >In stage (2), the original WCS information will be removed from the FitsChan by a destructive read.
Later, in stage (4), new WCS information is written to replace it. This is the process which we consider
next (&#x00A7;<a 
href="#x18-1790007">17.7<!--tex4ht:ref: ss:writingforeignfits --></a>).
<a 
 id="x18-178007r195"></a>
<h4 class="subsectionHead"><span class="titlemark">17.7    </span> <a 
 id="x18-1790007"></a>Writing Foreign WCS Information to a FITS Header</h4>
<!--l. 9430--><p class="noindent" >Before we can write processed WCS information held in a <a 
href="sun211ss453.html#x480-6720000">FrameSet</a> back into a <a 
href="sun211ss449.html#x476-6680000">FitsChan</a> in
preparation for output, we must select the FITS encoding to use. Unfortunately, we cannot simply
depend on the default value of the <a 
href="sun211ss284.html#x310-5020000">Encoding</a> attribute, as we did when reading the input information
(&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>), because the destructive action of reading the WCS data (&#x00A7;<a 
href="#x18-1770005">17.5<!--tex4ht:ref: ss:destructiveread --></a>) will have altered the FitsChan&#x2019;s
contents. This, in turn, will have changed the choice of default encoding, probably causing it to revert
to NATIVE.
<!--l. 9440--><p class="noindent" >We will return to the question of the optimum choice of encoding below. For now, let&#x2019;s assume that we
want to use the same encoding for output as we used for input. Since we enquired what that was
before we read the input WCS data from the FitsChan (&#x00A7;<a 
href="#x18-1750003">17.3<!--tex4ht:ref: ss:identifyingfitsencoding --></a>), we can now set that value explicitly. We
can also set the FitsChan&#x2019;s <a 
href="sun211ss258.html#x284-4760000">Card</a> attribute back to 1 at the same time (because the write will fail if the
FitsChan is not rewound). <a 
href="sun211ss237.html#x262-4540000">astWrite</a> can then be used to write the output WCS information into the
FitsChan:
<div class="fancyvrb" id="fancyvrb211"> <a 
 id="x18-179002r1"></a>&#x00A0;&#x00A0;int&#x00A0;nobj;<br class="fancyvrb" /><a 
 id="x18-179004r2"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-179006r3"></a>&#x00A0;&#x00A0;...<br class="fancyvrb" /><a 
 id="x18-179008r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-179010r5"></a>&#x00A0;&#x00A0;astSet(&#x00A0;fitschan,&#x00A0;&#x0022;Card=1,&#x00A0;Encoding=%s&#x0022;,&#x00A0;encode&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-179012r6"></a>&#x00A0;&#x00A0;nobj&#x00A0;=&#x00A0;astWrite(&#x00A0;fitschan,&#x00A0;wcsinfo&#x00A0;);</div>
<!--l. 9461--><p class="noindent" >The value returned by astWrite (assigned to &#x201C;nobj&#x201D;) indicates how many Objects were
written. This will either be 1 or zero. A value of zero is used to indicate that the information
could not be encoded in the form you requested. If this happens, nothing will have been
written.
                                                                                       

                                                                                       
<!--l. 9467--><p class="noindent" >If your choice of encoding proves inadequate, the probable reason is that the changes
you have made to the FrameSet have caused it to depart from the data model which
the encoding assumes. AST knows about the data model used by each encoding and
will attempt to simplify the FrameSet you provide so as to fit into that model, thus
relieving you of the need to understand the details and limitations of each encoding
yourself.<span class="footnote-mark"><a 
href="#fn30x0" id="fn30x0-bk"><sup class="textsuperscript">30</sup></a></span><a 
 id="x18-179013f30"></a>
When this attempt fails, however, you must consider what alternative encoding to use.
<!--l. 9480--><p class="noindent" >Ideally, you would probably want to try a sequence of alternative encodings, using an approach such
as the following:
<div class="fancyvrb" id="fancyvrb212"> <a 
 id="x18-179015r1"></a>&#x00A0;&#x00A0;/*&#x00A0;1.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x18-179017r2"></a>&#x00A0;&#x00A0;astSet(&#x00A0;fitschan,&#x00A0;&#x0022;Card=1,&#x00A0;Encoding=FITS-IRAF&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-179019r3"></a>&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!astWrite(&#x00A0;fitschan,&#x00A0;wcsinfo&#x00A0;)&#x00A0;)&#x00A0;{
<br class="fancyvrb" /><a 
 id="x18-179021r4"></a>&#x00A0;&#x00A0;<br class="fancyvrb" /><a 
 id="x18-179023r5"></a>&#x00A0;&#x00A0;/*&#x00A0;2.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x18-179025r6"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astSetC(&#x00A0;fitschan,&#x00A0;&#x0022;Encoding&#x0022;,&#x00A0;encode&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-179027r7"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(&#x00A0;!astWrite(&#x00A0;fitschan,&#x00A0;wcsinfo&#x00A0;)&#x00A0;)&#x00A0;{<br class="fancyvrb" /><a 
 id="x18-179029r8"></a>&#x00A0;&#x00A0;
<br class="fancyvrb" /><a 
 id="x18-179031r9"></a>&#x00A0;&#x00A0;/*&#x00A0;3.&#x00A0;*/<br class="fancyvrb" /><a 
 id="x18-179033r10"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;astSet(&#x00A0;fitschan,&#x00A0;&#x0022;Encoding=NATIVE&#x0022;&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-179035r11"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(void)&#x00A0;astWrite(&#x00A0;fitschan,&#x00A0;wcsinfo&#x00A0;);<br class="fancyvrb" /><a 
 id="x18-179037r12"></a>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}<br class="fancyvrb" /><a 
 id="x18-179039r13"></a>&#x00A0;&#x00A0;}</div>
<!--l. 9501--><p class="noindent" >That is:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  (1) </dt><dd 
class="enumerate-enumitem">Start  by  trying  the  FITS-WCS  encoding,  on  the  grounds  that  FITS  should  provide  a
     universal  interchange  standard  in  which  all  WCS  information  should  be  expressed  if
     possible.
     </dd><dt class="enumerate-enumitem">
  (2) </dt><dd 
class="enumerate-enumitem">If that fails, then try the original encoding used for the input WCS information, on the
     grounds that you are at least not making the information any harder for others to read
     than it originally was.
     </dd><dt class="enumerate-enumitem">
  (3) </dt><dd 
class="enumerate-enumitem">If  that  also  fails,  then  you  are  probably  trying  to  store  fairly  complex  information  for
     which you need the native encoding. Only other AST programs will then be able to read
     this information, but these are probably the only programs that will be able to do anything
     sensible with it anyway.</dd></dl>
<!--l. 9519--><p class="noindent" >An alternative approach might be to encode the WCS information in several ways, since this gives
the maximum chance that other software will be able to read it. This approach is only
possible if there is no significant conflict between the FITS keywords used by the different
encodings<span class="footnote-mark"><a 
href="#fn31x0" id="fn31x0-bk"><sup class="textsuperscript">31</sup></a></span><a 
 id="x18-179043f31"></a>.
Adopting this approach would simply require multiple calls to astWrite, rewinding the FitsChan and
changing its Encoding value before each one.
<!--l. 9529--><p class="noindent" >Unfortunately, however, there is a drawback to duplicating WCS information in the FITS header
in this way, because any program which modifies one version of this information and
simply copies the remainder of the header will risk producing two inconsistent sets of
information. This could obviously be confusing to subsequent software. Whether you consider
this a worthwhile risk probably depends on the use to which you expect your data to be
put.
                                                                                       

                                                                                       
                                                                                       

                                                                                       
<div class="footnotes"><!--l. 9011--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn26x0-bk" id="fn26x0"><sup class="textsuperscript">26</sup></a></span>Available by ftp from fits.cv.nrao.edu /fits/documents/wcs/wcs88.ps.Z
<!--l. 9024--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn27x0-bk" id="fn27x0"><sup class="textsuperscript">27</sup></a></span>There are many other differences between the previous and the current FITS-WCS encodings. The keywords to
describe axis rotation and scaling is used purely as a label to identify the scheme.
<!--l. 9032--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn28x0-bk" id="fn28x0"><sup class="textsuperscript">28</sup></a></span>Available by ftp from fits.cv.nrao.edu /fits/documents/wcs/aips27.ps.Z
<!--l. 9380--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn29x0-bk" id="fn29x0"><sup class="textsuperscript">29</sup></a></span>This can happen if a particular keyword is present in the input header but is not used in the output header (whether
particular keywords are used can depend on the WCS information being stored). In such a case, the original value would not
be over-written by a new output value, so would remain erroneously present.
<!--l. 9477--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn30x0-bk" id="fn30x0"><sup class="textsuperscript">30</sup></a></span>Storing values in the FitsChan for FITS headers NAXIS1, NAXIS2, <em>etc.</em> (the grid dimensions in pixels), before invoking
astWrite can sometimes help to produce a successful write.
<!--l. 9525--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn31x0-bk" id="fn31x0"><sup class="textsuperscript">31</sup></a></span>In practice, this means you should avoid mixing FITS-IRAF, FITS-WCS, FITS-AIPS, FITS-AIPS++ and FITS-PC
encodings since they share many keywords.                                                     </div> <div class="crosslinks">
<div class="copyright"><span class="pushright">Copyright (C) 2014 Science &#x0026; Technology Facilities Council</span></div> <ul class='nav'> <li class="prev"> <a 
href="sun211se16.html" >&#8592Prev</a>&#x00A0;</li> <li class="title">AST<BR>A Library for Handling<BR>World
Coordinate Systems<BR>in Astronomy</li> <li class="next"><a 
href="sun211se18.html" >Next&#8594</a>&#x00A0;</li> <li class="toc"><a 
href="sun211.html#toc">TOC &#8593</a></li> </ul></div>
<!--l. 9538--><p class="noindent" ><a 
 id="tailsun211se17.html"></a> 
</body> 
</html>